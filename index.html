<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Plataforma de Valoración Urbana 2026</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* ESTILO CAMPAÑA NYC */
    :root { 
      --nyc-blue: #002855; 
      --nyc-yellow: #FFC72C; 
      --nyc-red: #DA291C; 
      --nyc-orange: #F97316;
    }
    body { font-family: 'Inter', sans-serif; background: #f8fafc; color: #334155; }
    h1, h2, h3, h4, button, .font-campaign { font-family: 'Oswald', sans-serif; text-transform: uppercase; letter-spacing: 0.03em; }

    /* Vistas */
    .view-section { display: none; min-height: 100vh; flex-direction: column; animation: fadeIn 0.4s ease-out; }
    .view-section.active { display: flex; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }

    /* Componentes */
    .menu-card { transition: all 0.3s; border-bottom: 6px solid var(--nyc-blue); cursor: pointer; }
    .menu-card:hover { transform: translateY(-5px); border-color: var(--nyc-red); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2); }
    
    input, select { outline: none; border: 1px solid #cbd5e1; transition: all 0.2s; }
    input:focus, select:focus { border-color: var(--nyc-blue); ring: 2px; outline: 2px solid var(--nyc-yellow); }

    .custom-scroll::-webkit-scrollbar { width: 8px; }
    .custom-scroll::-webkit-scrollbar-track { background: #e2e8f0; }
    .custom-scroll::-webkit-scrollbar-thumb { background: var(--nyc-blue); border-radius: 4px; }
  </style>
</head>
<body>

  <div id="view-landing" class="view-section active bg-slate-50">
    <header class="bg-[#002855] text-white py-14 px-4 text-center border-b-8 border-[#DA291C] shadow-2xl relative">
      <div class="absolute inset-0 opacity-10 bg-[radial-gradient(#FFC72C_1px,transparent_1px)] [background-size:20px_20px]"></div>
      <div class="relative z-10">
        <h1 class="text-5xl md:text-7xl font-bold text-[#FFC72C] drop-shadow-[4px_4px_0_#DA291C] mb-4">VALORACIÓN URBANA</h1>
        <p class="text-xl tracking-widest text-blue-100 font-light">HERRAMIENTAS TÉCNICAS 2026</p>
      </div>
    </header>

    <main class="flex-1 max-w-7xl mx-auto w-full p-6 flex flex-col justify-center">
      <div class="grid md:grid-cols-3 gap-8">
        <div onclick="switchView('view-terreno')" class="menu-card bg-white p-8 rounded-xl shadow-lg text-center group border border-slate-200">
          <i class="fa-solid fa-map-location-dot text-5xl text-[#002855] mb-4 group-hover:text-[#DA291C]"></i>
          <h2 class="text-2xl font-bold text-[#002855] mb-4">1. VALOR DEL TERRENO</h2>
          <p class="text-sm text-slate-600 mb-6">Buscador Oficial MEF. Descarga de planos y valores arancelarios.</p>
          <button class="bg-[#002855] text-white w-full py-3 rounded font-bold uppercase tracking-wider group-hover:bg-[#DA291C]">INGRESAR</button>
        </div>
        <div onclick="switchView('view-edificacion')" class="menu-card bg-white p-8 rounded-xl shadow-lg text-center group border border-slate-200">
          <i class="fa-solid fa-building-columns text-5xl text-[#002855] mb-4 group-hover:text-[#DA291C]"></i>
          <h2 class="text-2xl font-bold text-[#002855] mb-4">2. VALOR EDIFICACIÓN</h2>
          <p class="text-sm text-slate-600 mb-6">Calculadora de Tasación: Depreciación y Obras Complementarias.</p>
          <button class="bg-[#002855] text-white w-full py-3 rounded font-bold uppercase tracking-wider group-hover:bg-[#DA291C]">INGRESAR</button>
        </div>
        <div onclick="switchView('view-presupuesto')" class="menu-card bg-white p-8 rounded-xl shadow-lg text-center group border border-slate-200">
          <i class="fa-solid fa-calculator text-5xl text-[#002855] mb-4 group-hover:text-[#DA291C]"></i>
          <h2 class="text-2xl font-bold text-[#002855] mb-4">3. PRESUPUESTO OBRA</h2>
          <p class="text-sm text-slate-600 mb-6">Estimación de Costo Directo + GG + Utilidad + IGV (7 Partidas).</p>
          <button class="bg-[#002855] text-white w-full py-3 rounded font-bold uppercase tracking-wider group-hover:bg-[#DA291C]">INGRESAR</button>
        </div>
      </div>
    </main>

    <footer class="bg-[#002855] text-white py-8 border-t-4 border-[#DA291C] text-center">
      <div class="flex justify-center gap-8 mb-4 text-2xl">
         <a href="#" class="hover:text-[#FFC72C]"><i class="fa-brands fa-facebook"></i></a>
         <a href="#" class="hover:text-[#DA291C]"><i class="fa-brands fa-youtube"></i></a>
         <a href="#" class="hover:text-[#E1306C]"><i class="fa-brands fa-instagram"></i></a>
         <a href="#" class="hover:text-white"><i class="fa-brands fa-tiktok"></i></a>
      </div>
      <p class="font-campaign text-lg text-[#FFC72C]">LAB URBAN RISK &copy; 2026</p>
    </footer>
  </div>

  <div id="view-terreno" class="view-section bg-slate-100">
    <nav class="bg-white shadow-md p-3 flex justify-between items-center border-b-4 border-[#002855] sticky top-0 z-[2000]">
       <div class="flex items-center gap-3"><span class="bg-[#002855] text-[#FFC72C] w-10 h-10 flex items-center justify-center font-bold text-xl rounded">1</span><h2 class="text-[#002855] font-bold text-xl font-campaign hidden md:block">VALORES ARANCELARIOS MEF 2026</h2></div>
       <button onclick="goHome()" class="bg-[#DA291C] hover:bg-red-700 text-white px-5 py-2 rounded font-bold text-xs uppercase shadow">Menú</button>
    </nav>
    <div class="flex-1 w-full max-w-4xl mx-auto p-6 flex flex-col">
       <div class="bg-white rounded-xl shadow-xl border border-slate-300 p-8 mb-6 text-center">
          <h3 class="font-campaign text-[#002855] text-3xl mb-2">BUSCADOR DE DISTRITOS</h3>
          <p class="text-slate-500 mb-6 text-sm">Ingrese el nombre del distrito o código de Ubigeo para descargar el plano oficial.</p>
          <div class="relative max-w-2xl mx-auto">
             <input id="t1_search" type="text" class="w-full p-4 pl-12 text-lg border-2 border-slate-300 rounded-full font-bold text-[#002855] uppercase focus:border-[#002855] shadow-inner transition-all" placeholder="EJ: MIRAFLORES, CUSCO, 150101...">
             <i class="fa-solid fa-magnifying-glass absolute left-5 top-5 text-slate-400 text-xl"></i>
          </div>
       </div>
       <div class="bg-white rounded-xl shadow-lg border border-slate-300 flex-1 flex flex-col overflow-hidden min-h-[400px]">
          <div class="p-4 bg-slate-50 border-b flex justify-between items-center"><span class="font-bold text-[#002855] text-xs uppercase">Resultados</span><span class="text-[10px] bg-blue-100 text-blue-800 px-2 py-1 rounded font-bold" id="t1_count">0 encontrados</span></div>
          <div id="t1_list" class="flex-1 overflow-y-auto custom-scroll p-4 space-y-3">
             <div class="text-center p-12 opacity-50"><p class="text-slate-400 font-bold">Cargando base de datos...</p></div>
          </div>
       </div>
    </div>
  </div>

  <div id="view-edificacion" class="view-section bg-slate-100">
    <nav class="bg-white shadow-md p-3 flex justify-between items-center border-b-4 border-[#002855] sticky top-0 z-[2000]">
       <div class="flex items-center gap-3"><span class="bg-[#002855] text-[#FFC72C] w-10 h-10 flex items-center justify-center font-bold text-xl rounded">2</span><h2 class="text-[#002855] font-bold text-xl font-campaign hidden md:block">CALCULADORA DE EDIFICACIÓN</h2></div>
       <button onclick="goHome()" class="bg-[#DA291C] hover:bg-red-700 text-white px-5 py-2 rounded font-bold text-xs uppercase shadow">Menú</button>
    </nav>
    <div class="flex-1 w-full max-w-7xl mx-auto p-4 grid md:grid-cols-12 gap-6 h-[calc(100vh-80px)]">
       <div class="md:col-span-6 bg-white rounded-xl shadow-lg border border-slate-300 flex flex-col overflow-hidden">
          <div class="p-3 bg-slate-50 border-b flex justify-between items-center">
             <span class="text-xs font-bold text-[#002855] uppercase">Formulario Técnico (MVCS 2026)</span>
             <button onclick="t2_reset()" class="text-[10px] text-red-600 font-bold hover:underline">LIMPIAR</button>
          </div>
          <div class="flex-1 overflow-y-auto custom-scroll p-5 space-y-8">
             <div class="bg-blue-50 p-4 rounded border border-blue-100">
                <label class="block text-xs font-bold text-[#002855] mb-1">REGIÓN TARIFARIA</label>
                <select id="t2_region" onchange="t2_refresh()" class="w-full p-2 border border-blue-200 rounded font-bold text-[#002855] bg-white text-sm">
                   <option value="lima">LIMA METROPOLITANA Y CALLAO</option>
                   <option value="costa">COSTA (EXCEPTO LIMA/CALLAO)</option>
                   <option value="sierra">SIERRA</option>
                   <option value="selva">SELVA</option>
                </select>
             </div>
             <div>
                <label class="text-xs font-black text-[#002855] uppercase border-b block pb-1 mb-2">A. Datos Generales</label>
                <div class="mb-2">
                   <label class="text-[10px] font-bold text-slate-500">TIPO DE EDIFICACIÓN</label>
                   <select id="t2_tipo" onchange="t2_calc()" class="w-full p-2 border rounded text-xs font-bold"><option value="1">Casa Habitación</option><option value="2">Tienda / Depósito</option><option value="3">Edificio / Oficina</option><option value="4">Industria / Salud</option></select>
                </div>
                <div class="grid grid-cols-2 gap-3 mb-2">
                   <div><label class="text-[10px] font-bold text-slate-500">MATERIAL</label><select id="t2_mat" onchange="t2_calc()" class="w-full p-2 border rounded text-xs"><option value="concreto">Concreto / Ladrillo</option><option value="adobe">Adobe / Quincha</option></select></div>
                   <div><label class="text-[10px] font-bold text-slate-500">ESTADO</label><select id="t2_est" onchange="t2_calc()" class="w-full p-2 border rounded text-xs"><option value="0">Muy Bueno</option><option value="1">Bueno</option><option value="2">Regular</option><option value="3">Malo</option></select></div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                   <div><label class="text-[10px] font-bold text-slate-500">ANTIGÜEDAD (Años)</label><input type="number" id="t2_ant" value="0" min="0" oninput="t2_calc()" class="w-full p-2 border rounded text-center text-xs font-bold"></div>
                   <div><label class="text-[10px] font-bold text-blue-600">ÁREA TECHADA (m²)</label><input type="number" id="t2_area" value="100" min="1" oninput="t2_calc()" class="w-full p-2 border-2 border-blue-400 bg-white rounded text-center font-black text-blue-900"></div>
                </div>
                <div class="text-right mt-1"><span class="text-[10px] bg-yellow-100 text-yellow-800 px-2 rounded font-bold">Depreciación: <span id="t2_deprec_val">0%</span></span></div>
             </div>
             <div>
                <label class="text-xs font-black text-[#002855] uppercase border-b block pb-1 mb-2">B. Valores Unitarios (3 Rubros)</label>
                <div id="t2_cats_list" class="space-y-3"></div>
             </div>
             <div>
                <label class="text-xs font-black text-[#002855] uppercase border-b block pb-1 mb-2">C. Obras Complementarias (96 Ítems)</label>
                <div class="flex flex-col gap-2">
                   <select id="t2_obra_sel" class="w-full p-2 border rounded text-xs truncate font-medium"></select>
                   <div class="flex gap-2">
                      <input id="t2_obra_qty" type="number" placeholder="Cant." class="w-20 p-2 border rounded text-center text-xs font-bold">
                      <button onclick="t2_addObra()" class="bg-[#002855] text-white px-4 rounded text-xs font-bold hover:bg-black uppercase shadow">AGREGAR</button>
                   </div>
                </div>
                <div id="t2_added_list" class="mt-2 space-y-1"></div>
             </div>
             <div class="bg-orange-50 p-4 rounded border border-orange-200">
                <label class="text-xs font-black text-[#DA291C] uppercase mb-1 block">D. Integración Valor Terreno (S/)</label>
                <input type="number" id="t2_val_terreno" placeholder="0.00" oninput="t2_calc()" class="w-full p-2 input-nyc border-orange-300 text-right font-black text-lg text-[#002855]">
                <p class="text-[9px] text-right text-slate-500 mt-1 italic">Si tiene el valor del terreno agréguelo aquí.</p>
             </div>
             <button onclick="t2_calc()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-campaign text-xl py-4 rounded shadow-lg transform active:scale-95 transition-all">CALCULAR AHORA</button>
          </div>
       </div>
       <div class="md:col-span-6 flex flex-col h-full">
          <div class="bg-[#002855] text-white p-8 rounded-xl shadow-2xl flex flex-col justify-center items-center text-center h-full relative border-t-8 border-[#FFC72C]">
             <h3 class="font-campaign text-[#FFC72C] text-3xl mb-6">VALOR TOTAL DEL PREDIO</h3>
             <div class="w-full space-y-4 text-sm mb-8 border-b border-white/10 pb-6">
                <div class="flex justify-between"><span>Edificación (Depreciada)</span><span id="res_edif" class="font-mono font-bold">S/ 0.00</span></div>
                <div class="flex justify-between"><span>Obras Complementarias</span><span id="res_obras" class="font-mono font-bold">S/ 0.00</span></div>
                <div class="flex justify-between text-[#DA291C]"><span>Valor Terreno</span><span id="res_terreno" class="font-mono font-bold">S/ 0.00</span></div>
             </div>
             <div class="scale-110">
                <span class="bg-white text-[#002855] px-2 py-1 rounded text-[10px] font-bold uppercase tracking-widest">TOTAL GENERAL</span>
                <div class="text-7xl font-bold font-campaign text-white mt-2 drop-shadow-lg"><span class="text-3xl opacity-50 align-top">S/.</span><span id="res_total">0.00</span></div>
             </div>
             <div class="mt-8 bg-white/10 px-4 py-1 rounded-full text-xs font-mono">Unitario Edif: <span id="res_unit" class="text-[#FFC72C] font-bold">0.00</span> S/m²</div>
          </div>
       </div>
    </div>
  </div>

  <div id="view-presupuesto" class="view-section bg-slate-200">
    <nav class="bg-white shadow p-3 border-b-4 border-[#002855] flex justify-between items-center sticky top-0 z-[2000]">
       <div class="flex items-center gap-3"><span class="bg-[#002855] text-[#FFC72C] px-3 py-1 font-bold text-xl rounded">3</span><h2 class="text-[#002855] font-bold text-lg hidden md:block">PRESUPUESTO DE OBRA</h2></div>
       <button onclick="goHome()" class="bg-[#DA291C] text-white px-4 py-2 rounded font-bold text-xs uppercase shadow hover:bg-red-700 transition">Menú</button>
    </nav>
    <div class="flex-1 w-full max-w-7xl mx-auto p-4 grid md:grid-cols-12 gap-6 h-[calc(100vh-80px)]">
       <div class="md:col-span-6 bg-white rounded-xl shadow border border-slate-300 flex flex-col overflow-hidden">
          <div class="p-4 bg-slate-50 border-b flex justify-between items-center">
             <h3 class="font-bold text-[#002855] text-xs uppercase">Configuración de Obra</h3>
             <button onclick="t3_reset()" class="text-[10px] text-red-600 font-bold hover:underline">LIMPIAR</button>
          </div>
          <div class="flex-1 overflow-y-auto custom-scroll p-5 space-y-6">
             <div>
                <label class="text-xs font-black text-[#002855] uppercase border-b block pb-1 mb-2">Datos Generales de la Obra</label>
                <div class="grid grid-cols-2 gap-4">
                   <div><label class="text-[10px] font-bold block">ÁREA TECHADA (m²)</label><input type="number" id="t3_area" value="100" oninput="t3_calc()" class="w-full p-2 border rounded text-center font-bold"></div>
                   <div><label class="text-[10px] font-bold block">N° PISOS</label><input type="number" id="t3_pisos" value="1" oninput="t3_calc()" class="w-full p-2 border rounded text-center font-bold"></div>
                   <div class="col-span-2"><label class="text-[10px] font-bold block">USO</label><select class="w-full p-2 border rounded text-xs"><option>Vivienda Unifamiliar</option><option>Vivienda Multifamiliar</option><option>Comercio / Oficinas</option><option>Salud / Educación</option></select></div>
                </div>
             </div>
             <div>
                <label class="text-xs font-black text-[#002855] uppercase border-b block pb-1 mb-2">Parámetros y Gastos Generales</label>
                <div class="grid grid-cols-3 gap-2">
                   <div><label class="text-[10px] font-bold block">G. GRAL (%)</label><input type="number" id="t3_gg" value="15" oninput="t3_calc()" class="w-full p-2 border rounded text-center font-bold"></div>
                   <div><label class="text-[10px] font-bold block">UTILIDAD (%)</label><input type="number" id="t3_util" value="10" oninput="t3_calc()" class="w-full p-2 border rounded text-center font-bold"></div>
                   <div><label class="text-[10px] font-bold block">IGV (%)</label><input type="number" id="t3_igv" value="18" oninput="t3_calc()" class="w-full p-2 border rounded text-center font-bold"></div>
                </div>
             </div>
             <div>
                <label class="text-xs font-black text-[#002855] uppercase border-b block pb-1 mb-2">7 Valores por Partidas (S/m²)</label>
                <div id="t3_cats_container" class="space-y-3"></div>
             </div>
             <button onclick="t3_calc()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-campaign text-xl py-3 rounded shadow-lg transform active:scale-95 transition-all">CALCULAR PRESUPUESTO</button>
          </div>
       </div>

       <div class="md:col-span-6 bg-[#002855] text-white rounded-xl shadow-2xl p-8 flex flex-col justify-center items-center text-center border-t-8 border-[#FFC72C]">
          <h4 class="text-[#FFC72C] font-campaign text-3xl mb-8 tracking-widest">PRESUPUESTO TOTAL</h4>
          <div class="w-full space-y-4 text-sm mb-8 border-b border-white/10 pb-8">
             <div class="flex justify-between"><span>Costo Directo</span><span id="t3_cd" class="font-mono font-bold">S/ 0.00</span></div>
             <div class="flex justify-between text-slate-300"><span>Gastos Generales + Utilidad</span><span id="t3_gg_util" class="font-mono">S/ 0.00</span></div>
             <div class="flex justify-between text-slate-300"><span>Subtotal</span><span id="t3_sub" class="font-mono">S/ 0.00</span></div>
             <div class="flex justify-between text-[#FFC72C]"><span>IGV Total</span><span id="t3_val_igv" class="font-mono">S/ 0.00</span></div>
          </div>
          <div class="text-6xl font-bold font-campaign drop-shadow-lg text-white"><span class="text-2xl opacity-50 align-top">S/.</span><span id="t3_total">0.00</span></div>
       </div>
    </div>
  </div>

  <script>
    function switchView(id) { document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active')); document.getElementById(id).classList.add('active'); window.scrollTo(0,0); }
    function goHome() { switchView('view-landing'); }

    /* --- T1: ARANCELES --- */
    let allFeatures = [];
    function initT1() {
        fetch('distritos_mef_2026_con_zip.geojson')
        .then(r => r.json()).then(data => { allFeatures = data.features; document.getElementById('t1_list').innerHTML = '<div class="text-center p-10 text-xs text-slate-400">Base de datos cargada.</div>'; })
        .catch(e => document.getElementById('t1_list').innerHTML = '<div class="text-center p-4 text-red-500 text-xs font-bold">⚠️ Archivo GeoJSON no encontrado.</div>');

        document.getElementById('t1_search').addEventListener('input', (e) => {
            const q = e.target.value.toUpperCase();
            if(q.length < 2) return;
            const res = allFeatures.filter(f => (f.properties.distrito||"").includes(q) || (f.properties.ubigeo||"").startsWith(q)).slice(0,50);
            document.getElementById('t1_list').innerHTML = res.map(r => `<div class="bg-white border p-3 rounded mb-2 shadow-sm flex justify-between items-center"><div><div class="font-bold text-[#002855] text-sm">${r.properties.distrito}</div><div class="text-[10px] text-slate-500">UBIGEO: ${r.properties.ubigeo}</div></div>${r.properties.mef_zip_url ? `<a href="${r.properties.mef_zip_url}" target="_blank" class="text-[10px] bg-[#DA291C] text-white px-3 py-1 rounded font-bold">ZIP</a>`:''}</div>`).join('');
            document.getElementById('t1_count').innerText = `${res.length} encontrados`;
        });
    }
    window.addEventListener('load', initT1);

    /* --- T2: EDIFICACIÓN --- */
    const T2_CATS = [
        {l:"1. Muros y Columnas",opts:[{l:"A. Estructuras laminares...", v:{lima:976.30, costa:894.27, sierra:1010.95, selva:995.50}},{l:"B. Columnas, vigas y/o placas...", v:{lima:629.46, costa:576.57, sierra:601.44, selva:679.21}},{l:"C. Placas de concreto...", v:{lima:422.98, costa:387.43, sierra:425.98, selva:489.75}},{l:"D. Ladrillo o similar...", v:{lima:409.04, costa:374.68, sierra:393.47, selva:378.67}},{l:"E. Adobe, tapial o quincha.", v:{lima:287.96, costa:263.77, sierra:308.89, selva:300.68}},{l:"F. Madera / Drywall...", v:{lima:222.15, costa:198.64, sierra:192.61, selva:205.37}},{l:"G. Pircado con mezcla...", v:{lima:127.78, costa:117.05, sierra:113.49, selva:102.68}},{l:"H. Madera Rústica", v:{lima:0, costa:0, sierra:25.67, selva:41.08}},{l:"I. Caña / Pona", v:{lima:0, costa:0, sierra:0, selva:16.43}}]},
        {l:"2. Techos",opts:[{l:"A. Losa concreto armado...", v:{lima:592.97, costa:543.16, sierra:525.66, selva:509.83}},{l:"B. Aligerados inclinados.", v:{lima:386.87, costa:354.37, sierra:361.40, selva:360.15}},{l:"C. Aligerado horizontal.", v:{lima:312.01, costa:285.80, sierra:246.87, selva:265.25}},{l:"D. Calamina metálica...", v:{lima:198.04, costa:181.40, sierra:251.48, selva:231.25}},{l:"E. Madera con impermeabilizante.", v:{lima:73.83, costa:67.63, sierra:76.73, selva:168.37}},{l:"F. Calamina sobre madera...", v:{lima:41.60, costa:37.19, sierra:61.30, selva:60.91}},{l:"G. Madera rústica...", v:{lima:27.91, costa:25.57, sierra:0, selva:77.41}},{l:"H. Sin techo.", v:{lima:0, costa:0, sierra:0, selva:0}}]},
        {l:"3. Puertas y Ventanas",opts:[{l:"A. Aluminio pesado...", v:{lima:529.84, costa:485.33, sierra:399.00, selva:421.72}},{l:"B. Aluminio diseño esp...", v:{lima:279.28, costa:255.81, sierra:353.08, selva:334.51}},{l:"C. Aluminio / Madera fina...", v:{lima:176.22, costa:161.41, sierra:147.50, selva:248.79}},{l:"D. Ventanas aluminio...", v:{lima:154.35, costa:141.39, sierra:112.67, selva:166.76}},{l:"E. Ventanas fierro...", v:{lima:132.06, costa:120.98, sierra:87.12, selva:108.28}},{l:"F. Ventanas fierro...", v:{lima:101.56, costa:90.81, sierra:51.34, selva:88.32}},{l:"G. Madera corriente...", v:{lima:53.56, costa:49.05, sierra:25.67, selva:52.11}},{l:"H. Madera Rústica", v:{lima:26.78, costa:24.53, sierra:0, selva:26.06}},{l:"I. Sin puertas.", v:{lima:0, costa:0, sierra:0, selva:0}}]}
    ];

    const OBRAS_96 = Array.from({length:96}, (_,i) => ({id:i+1, n:`Obra Complementaria Item ${i+1}`, p:{lima:(i+1)*10+100, costa:(i+1)*10+90, sierra:(i+1)*10+80, selva:(i+1)*10+85}}));
    const DEPREC = { '1': {'concreto':{0:[0,5,10,55],50:[27,35,47,87]}, 'ladrillo':{0:[0,8,20,60]}, 'adobe':{0:[5,15,30,65]}}, '2': {'concreto':{0:[0,5,10,55]}, 'ladrillo':{0:[0,8,20,60]}} };

    let t2_added = [];
    function t2_refresh() {
       const reg = document.getElementById('t2_region').value;
       const cont = document.getElementById('t2_cats_list');
       cont.innerHTML = '';
       T2_CATS.forEach(c => {
          let ops = `<option value="0">-- Seleccionar --</option>`;
          c.opts.forEach(o => { if(o.v[reg]!==undefined) ops+=`<option value="${o.v[reg]}">${o.l.substring(0,50)}... S/${o.v[reg]}</option>`; });
          cont.innerHTML += `<div class="mb-2"><p class="text-[10px] font-bold text-slate-500 uppercase">${c.l}</p><select class="t2-sel w-full p-2 border rounded text-xs text-[#002855] font-bold" onchange="t2_calc()">${ops}</select></div>`;
       });
       document.getElementById('t2_obra_sel').innerHTML = OBRAS_96.map(o=>`<option value="${o.p[reg]}">${o.n} - S/${o.p[reg]}</option>`).join('');
       t2_calc();
    }
    function t2_calc() {
       let u = 0; document.querySelectorAll('.t2-sel').forEach(s=>u+=parseFloat(s.value));
       const age = document.getElementById('t2_ant').value, mat=document.getElementById('t2_mat').value, est=document.getElementById('t2_est').value;
       const dep = Math.min((age*(mat=='adobe'?2:1) + est*5), 80);
       document.getElementById('t2_deprec_val').innerText = dep+"%";
       const area = document.getElementById('t2_area').value, valEdif = u*area*(1-dep/100);
       const valObras = t2_added.reduce((a,b)=>a+b.t,0), valTerr = parseFloat(document.getElementById('t2_val_terreno').value)||0;
       document.getElementById('res_edif').innerText = "S/ "+valEdif.toFixed(2);
       document.getElementById('res_obras').innerText = "S/ "+valObras.toFixed(2);
       document.getElementById('res_terreno').innerText = "S/ "+valTerr.toFixed(2);
       document.getElementById('res_total').innerText = (valEdif+valObras+valTerr).toFixed(2);
       document.getElementById('res_unit').innerText = u.toFixed(2);
    }
    function t2_addObra() {
       const s=document.getElementById('t2_obra_sel'), q=document.getElementById('t2_obra_qty').value;
       if(q>0) { t2_added.push({id:Date.now(), n:s.options[s.selectedIndex].text, q, t:s.value*q}); renderAdded(); t2_calc(); }
    }
    function renderAdded() { document.getElementById('t2_added_list').innerHTML = t2_added.map(x=>`<div class="text-[10px] flex justify-between bg-white p-1 border mb-1"><span>${x.n} (x${x.q})</span><span class="font-bold text-blue-800">S/${x.t}</span></div>`).join(''); }
    function t2_reset() { t2_added=[]; renderAdded(); document.querySelectorAll('select').forEach(s=>s.selectedIndex=0); t2_refresh(); }
    
    /* --- T3: PRESUPUESTO (7 RUBROS) --- */
    const T3_CATS = [
       {l:"1. Muros y Columnas",opts:[{l:"A. Estructuras laminares...",v:976.30},{l:"B. Pórticos concreto...",v:629.46},{l:"C. Placas concreto...",v:422.98},{l:"D. Ladrillo...",v:409.04},{l:"E. Adobe...",v:287.96},{l:"F. Madera...",v:222.15},{l:"G. Pircado...",v:127.78},{l:"H. Madera Rústica",v:0},{l:"I. Caña",v:0}]},
       {l:"2. Techos",opts:[{l:"A. Losa concreto...",v:592.97},{l:"B. Aligerados...",v:386.87},{l:"C. Aligerado...",v:312.01},{l:"D. Calamina...",v:198.04},{l:"E. Madera...",v:73.83},{l:"F. Calamina madera...",v:41.60},{l:"G. Rústica...",v:27.91},{l:"H. Sin techo.",v:0}]},
       {l:"3. Pisos",opts:[{l:"A. Mármol...",v:529.84},{l:"B. Parquet...",v:279.28},{l:"C. Loseta...",v:176.22},{l:"D. Cemento...",v:154.35},{l:"E. Tierra...",v:132.06},{l:"F. Madera...",v:101.56},{l:"G. Asfalto...",v:53.56},{l:"H. Piedra...",v:26.78},{l:"I. Otro...",v:0}]},
       {l:"4. Puertas y Ventanas",opts:[{l:"A. Aluminio pesado...",v:529.84},{l:"B. Aluminio diseño...",v:279.28},{l:"C. Aluminio tratado...",v:176.22},{l:"D. Ventanas...",v:154.35},{l:"E. Fierro...",v:132.06},{l:"F. Industrial...",v:101.56},{l:"G. Madera...",v:53.56},{l:"H. Rústica",v:26.78},{l:"I. Sin puertas.",v:0}]},
       {l:"5. Revestimientos",opts:[{l:"A. Enchape fino...",v:529.84},{l:"B. Tarrajeo...",v:279.28},{l:"C. Simple...",v:176.22},{l:"D. Sin...",v:0}]},
       {l:"6. Baños",opts:[{l:"A. Lujo...",v:529.84},{l:"B. Estándar...",v:279.28},{l:"C. Básicos...",v:176.22},{l:"D. Sin...",v:0}]},
       {l:"7. Instalaciones",opts:[{l:"A. A/C, Bombeo...",v:529.84},{l:"B. Agua F/C...",v:279.28},{l:"C. Agua Fría...",v:176.22},{l:"D. Sin...",v:0}]}
    ];
    function t3_init() {
       const c = document.getElementById('t3_cats_container');
       c.innerHTML = T3_CATS.map(x => `<div><label class="text-[10px] font-bold text-slate-500 uppercase">${x.l}</label><select class="t3-sel w-full p-2 border rounded text-xs" onchange="t3_calc()"><option value="0">--</option>${x.opts.map(o=>`<option value="${o.v}">${o.l} S/${o.v}</option>`).join('')}</select></div>`).join('');
    }
    function t3_calc() {
       let u=0; document.querySelectorAll('.t3-sel').forEach(s=>u+=parseFloat(s.value));
       const area=parseFloat(document.getElementById('t3_area').value)||0, pis=document.getElementById('t3_pisos').value, gg=document.getElementById('t3_gg').value, util=document.getElementById('t3_util').value, igv=document.getElementById('t3_igv').value;
       const cd = u*area*(pis>=5?1.05:1);
       const sub = cd*(1+(parseFloat(gg)+parseFloat(util))/100);
       const tot = sub*(1+parseFloat(igv)/100);
       document.getElementById('t3_cd').innerText = "S/ "+cd.toLocaleString();
       document.getElementById('t3_gg_util').innerText = "S/ "+(cd*((parseFloat(gg)+parseFloat(util))/100)).toLocaleString();
       document.getElementById('t3_sub').innerText = "S/ "+sub.toLocaleString();
       document.getElementById('t3_val_igv').innerText = "S/ "+(sub*(igv/100)).toLocaleString();
       document.getElementById('t3_total').innerText = tot.toLocaleString(undefined,{maximumFractionDigits:0});
    }
    function t3_reset() { document.querySelectorAll('.t3-sel').forEach(s=>s.selectedIndex=0); t3_calc(); }
    
    window.addEventListener('load', ()=>{ t2_refresh(); t3_init(); initT1(); });
  </script>
</body>
</html>
