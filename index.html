<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Plataforma Técnica de Valoración Urbana</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

  <style>
    /* --- ESTILO NYC CAMPAIGN --- */
    :root { --nyc-blue: #002855; --nyc-yellow: #FFC72C; --nyc-red: #DA291C; }
    body { font-family: 'Inter', sans-serif; background: #f1f5f9; color: #334155; }
    h1, h2, h3, h4, .font-campaign { font-family: 'Oswald', sans-serif; text-transform: uppercase; letter-spacing: 0.03em; }
    
    /* Vistas */
    .view-section { display: none; min-height: 100vh; flex-direction: column; animation: fadeIn 0.4s ease-out; }
    .view-section.active { display: flex; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }

    /* Componentes */
    .menu-card { transition: all 0.3s; border-bottom: 6px solid var(--nyc-blue); cursor: pointer; }
    .menu-card:hover { transform: translateY(-5px); border-color: var(--nyc-red); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2); }
    
    .input-nyc { border: 1px solid #cbd5e1; outline: none; transition: all 0.2s; }
    .input-nyc:focus { border-color: var(--nyc-blue); ring: 2px; outline: 2px solid var(--nyc-yellow); }

    .custom-scroll::-webkit-scrollbar { width: 8px; }
    .custom-scroll::-webkit-scrollbar-track { background: #e2e8f0; }
    .custom-scroll::-webkit-scrollbar-thumb { background: var(--nyc-blue); border-radius: 4px; }
  </style>
</head>
<body>

  <div id="view-landing" class="view-section active bg-slate-50">
    <header class="bg-[#002855] text-white py-14 px-4 text-center border-b-8 border-[#DA291C] shadow-2xl">
      <h1 class="text-5xl md:text-7xl font-bold text-[#FFC72C] drop-shadow-[4px_4px_0_#DA291C] mb-4">VALORACIÓN URBANA</h1>
      <p class="text-xl tracking-widest text-blue-100">HERRAMIENTAS TÉCNICAS PROFESIONALES</p>
    </header>

    <main class="flex-1 max-w-7xl mx-auto w-full p-6 flex flex-col justify-center">
      <div class="grid md:grid-cols-3 gap-8">
        <div onclick="switchView('view-terreno')" class="menu-card bg-white p-8 rounded-xl shadow-lg text-center group border border-slate-200">
          <div class="w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:bg-[#DA291C] transition-colors">
            <i class="fa-solid fa-map-location-dot text-5xl text-[#002855] group-hover:text-white"></i>
          </div>
          <h2 class="text-3xl font-bold text-[#002855] mb-4">1. VALOR DEL TERRENO</h2>
          <p class="text-slate-600 mb-6 text-sm">Buscador Oficial MEF. Consulta por distrito/ubigeo y descarga de planos.</p>
          <button class="bg-[#002855] text-white w-full py-3 rounded font-bold uppercase tracking-wider group-hover:bg-[#DA291C]">INGRESAR</button>
        </div>

        <div onclick="switchView('view-edificacion')" class="menu-card bg-white p-8 rounded-xl shadow-lg text-center group border border-slate-200">
          <div class="w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:bg-[#DA291C] transition-colors">
            <i class="fa-solid fa-building-columns text-5xl text-[#002855] group-hover:text-white"></i>
          </div>
          <h2 class="text-3xl font-bold text-[#002855] mb-4">2. VALOR EDIFICACIÓN</h2>
          <p class="text-slate-600 mb-6 text-sm">Calculadora MVCS: 3 Componentes Principales, Depreciación y 96 Obras Complementarias.</p>
          <button class="bg-[#002855] text-white w-full py-3 rounded font-bold uppercase tracking-wider group-hover:bg-[#DA291C]">INGRESAR</button>
        </div>

        <div onclick="switchView('view-presupuesto')" class="menu-card bg-white p-8 rounded-xl shadow-lg text-center group border border-slate-200">
          <div class="w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:bg-[#DA291C] transition-colors">
            <i class="fa-solid fa-calculator text-5xl text-[#002855] group-hover:text-white"></i>
          </div>
          <h2 class="text-3xl font-bold text-[#002855] mb-4">3. PRESUPUESTO</h2>
          <p class="text-slate-600 mb-6 text-sm">Estimación de Obra Nueva: Partidas Detalladas, GG y Utilidad.</p>
          <button class="bg-[#002855] text-white w-full py-3 rounded font-bold uppercase tracking-wider group-hover:bg-[#DA291C]">INGRESAR</button>
        </div>
      </div>
    </main>

    <footer class="bg-[#002855] text-white py-8 border-t-4 border-[#DA291C]">
      <div class="max-w-6xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-6">
        <div class="text-center md:text-left">
           <h4 class="font-campaign text-[#FFC72C] text-xl">LAB URBAN RISK</h4>
           <p class="text-xs text-slate-300">Investigación aplicada.</p>
        </div>
        <div class="flex gap-6 text-2xl">
           <a href="https://facebook.com" target="_blank" class="hover:text-[#FFC72C]"><i class="fa-brands fa-facebook"></i></a>
           <a href="https://youtube.com" target="_blank" class="hover:text-[#DA291C]"><i class="fa-brands fa-youtube"></i></a>
           <a href="https://instagram.com" target="_blank" class="hover:text-[#E1306C]"><i class="fa-brands fa-instagram"></i></a>
           <a href="https://tiktok.com" target="_blank" class="hover:text-white"><i class="fa-brands fa-tiktok"></i></a>
        </div>
      </div>
    </footer>
  </div>

  <div id="view-terreno" class="view-section bg-slate-100">
    <nav class="bg-white shadow-md p-3 flex justify-between items-center border-b-4 border-[#002855] sticky top-0 z-[2000]">
       <div class="flex items-center gap-3">
          <span class="bg-[#002855] text-[#FFC72C] w-10 h-10 flex items-center justify-center font-bold text-xl rounded">1</span>
          <h2 class="text-[#002855] font-bold text-xl font-campaign hidden md:block">VALORES ARANCELARIOS MEF 2026</h2>
       </div>
       <button onclick="goHome()" class="bg-[#DA291C] hover:bg-red-700 text-white px-5 py-2 rounded font-bold text-xs uppercase shadow flex items-center gap-2 transition"><i class="fa-solid fa-house"></i> Menú</button>
    </nav>

    <div class="flex-1 w-full max-w-4xl mx-auto p-6 flex flex-col">
       <div class="bg-white rounded-xl shadow-xl border border-slate-300 p-8 mb-6 text-center">
          <h3 class="font-campaign text-[#002855] text-3xl mb-2">BUSCADOR DE DISTRITOS</h3>
          <p class="text-slate-500 mb-6 text-sm">Ingrese nombre o Ubigeo para descargar el plano oficial.</p>
          <div class="relative max-w-2xl mx-auto">
             <input id="t1_search" type="text" class="w-full p-4 pl-12 text-lg border-2 border-slate-300 rounded-full font-bold text-[#002855] uppercase focus:border-[#002855] shadow-inner" placeholder="EJ: MIRAFLORES, CUSCO, 150101...">
             <i class="fa-solid fa-magnifying-glass absolute left-5 top-5 text-slate-400 text-xl"></i>
          </div>
       </div>
       <div class="bg-white rounded-xl shadow-lg border border-slate-300 flex-1 flex flex-col overflow-hidden min-h-[400px]">
          <div class="p-4 bg-slate-50 border-b flex justify-between items-center">
             <span class="font-bold text-[#002855] text-xs uppercase">Resultados</span>
             <span class="text-[10px] bg-blue-100 text-blue-800 px-2 py-1 rounded font-bold" id="t1_count">0 encontrados</span>
          </div>
          <div id="t1_list" class="flex-1 overflow-y-auto custom-scroll p-4 space-y-3">
             <div class="text-center p-12 opacity-50"><p class="text-slate-400 font-bold">Cargando base de datos...</p></div>
          </div>
       </div>
    </div>
  </div>

  <div id="view-edificacion" class="view-section bg-slate-100">
    <nav class="bg-white shadow-md p-3 flex justify-between items-center border-b-4 border-[#002855] sticky top-0 z-[2000]">
       <div class="flex items-center gap-3">
          <span class="bg-[#002855] text-[#FFC72C] w-10 h-10 flex items-center justify-center font-bold text-xl rounded">2</span>
          <h2 class="text-[#002855] font-bold text-xl font-campaign hidden md:block">CALCULADORA DE EDIFICACIÓN</h2>
       </div>
       <button onclick="goHome()" class="bg-[#DA291C] hover:bg-red-700 text-white px-5 py-2 rounded font-bold text-xs uppercase shadow flex items-center gap-2 transition"><i class="fa-solid fa-house"></i> Menú</button>
    </nav>

    <div class="flex-1 w-full max-w-7xl mx-auto p-4 grid md:grid-cols-12 gap-6 h-[calc(100vh-80px)]">
       <div class="md:col-span-6 bg-white rounded-xl shadow-lg border border-slate-300 flex flex-col overflow-hidden">
          <div class="p-3 bg-slate-50 border-b flex justify-between items-center">
             <span class="text-xs font-bold text-[#002855] uppercase">Formulario Técnico (MVCS)</span>
             <button onclick="t2_reset()" class="text-[10px] text-red-600 font-bold hover:underline">LIMPIAR</button>
          </div>
          
          <div class="flex-1 overflow-y-auto custom-scroll p-5 space-y-8">
             
             <div class="bg-blue-50 p-4 rounded border border-blue-100">
                <label class="block text-xs font-bold text-[#002855] mb-1">REGIÓN TARIFARIA</label>
                <select id="t2_region" onchange="t2_refresh()" class="w-full p-2 border border-blue-200 rounded font-bold text-[#002855] bg-white">
                   <option value="lima">LIMA METROPOLITANA Y CALLAO</option>
                   <option value="costa">COSTA (EXCEPTO LIMA/CALLAO)</option>
                   <option value="sierra">SIERRA</option>
                   <option value="selva">SELVA</option>
                </select>
             </div>

             <div>
                <label class="text-xs font-black text-[#002855] uppercase border-b block pb-1 mb-2">A. Datos Generales</label>
                <div class="grid grid-cols-2 gap-3 mb-2">
                   <div>
                      <label class="text-[10px] font-bold text-slate-500">MATERIAL</label>
                      <select id="t2_mat" onchange="t2_calc()" class="w-full p-2 input-nyc rounded text-xs"><option value="concreto">Concreto / Ladrillo</option><option value="adobe">Adobe / Quincha</option></select>
                   </div>
                   <div>
                      <label class="text-[10px] font-bold text-slate-500">ESTADO</label>
                      <select id="t2_est" onchange="t2_calc()" class="w-full p-2 input-nyc rounded text-xs"><option value="muy_bueno">Muy Bueno</option><option value="bueno">Bueno</option><option value="regular">Regular</option><option value="malo">Malo</option></select>
                   </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                   <div><label class="text-[10px] font-bold text-slate-500">ANTIGÜEDAD (Años)</label><input type="number" id="t2_ant" value="0" min="0" oninput="t2_calc()" class="w-full p-2 input-nyc rounded text-center text-xs"></div>
                   <div><label class="text-[10px] font-bold text-blue-600">ÁREA TECHADA (m²)</label><input type="number" id="t2_area" value="100" min="1" oninput="t2_calc()" class="w-full p-2 input-nyc border-blue-400 bg-blue-50 text-blue-900 rounded text-center font-bold"></div>
                </div>
                <div class="text-right mt-1"><span class="text-[10px] bg-yellow-100 text-yellow-800 px-2 rounded font-bold">Depreciación: <span id="t2_deprec_val">0%</span></span></div>
             </div>

             <div>
                <label class="text-xs font-black text-[#002855] uppercase border-b block pb-1 mb-2">B. Valores Unitarios (Componentes)</label>
                <div id="t2_cats_list" class="space-y-3"></div>
             </div>

             <div>
                <label class="text-xs font-black text-[#002855] uppercase border-b block pb-1 mb-2">C. Obras Complementarias (96 Ítems)</label>
                <div class="flex flex-col gap-2">
                   <select id="t2_obra_sel" class="w-full p-2 input-nyc rounded text-xs truncate font-medium"></select>
                   <div class="flex gap-2">
                      <input id="t2_obra_qty" type="number" placeholder="Cant." class="w-20 p-2 input-nyc rounded text-center text-xs font-bold">
                      <button onclick="t2_addObra()" class="bg-[#002855] text-white px-4 rounded text-xs font-bold hover:bg-black uppercase shadow">AGREGAR</button>
                   </div>
                </div>
                <div id="t2_added_list" class="mt-2 space-y-1"></div>
             </div>

             <div class="bg-orange-50 p-4 rounded border border-orange-200">
                <label class="text-xs font-black text-[#DA291C] uppercase mb-1 block">D. Integración Valor Terreno (S/)</label>
                <input type="number" id="t2_val_terreno" placeholder="0.00" oninput="t2_calc()" class="w-full p-2 input-nyc border-orange-300 text-right font-black text-lg text-[#002855]">
                <p class="text-[9px] text-slate-500 mt-1 italic">Si tiene el valor del terreno agréguelo aquí, sino busque en la herramienta valor arancelario.</p>
             </div>

             <button onclick="t2_calc()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-campaign text-xl py-3 rounded shadow-lg transform active:scale-95 transition-all">
                CALCULAR AHORA
             </button>
          </div>
       </div>

       <div class="md:col-span-6 flex flex-col h-full">
          <div class="bg-[#002855] text-white p-8 rounded-xl shadow-2xl flex flex-col justify-center items-center text-center h-full relative border-t-8 border-[#FFC72C]">
             <h3 class="font-campaign text-[#FFC72C] text-3xl mb-6">VALOR TOTAL DEL PREDIO</h3>
             <div class="w-full space-y-4 text-sm mb-8 border-b border-white/10 pb-6">
                <div class="flex justify-between"><span>Edificación (Depreciada)</span><span id="res_edif" class="font-mono font-bold">S/ 0.00</span></div>
                <div class="flex justify-between"><span>Obras Complementarias</span><span id="res_obras" class="font-mono font-bold">S/ 0.00</span></div>
                <div class="flex justify-between text-[#DA291C]"><span>Valor Terreno</span><span id="res_terreno" class="font-mono font-bold">S/ 0.00</span></div>
             </div>
             <div class="scale-110">
                <span class="bg-white text-[#002855] px-2 py-1 rounded text-[10px] font-bold uppercase tracking-widest">TOTAL GENERAL</span>
                <div class="text-7xl font-bold font-campaign text-white mt-2 drop-shadow-lg"><span class="text-3xl opacity-50 align-top">S/.</span><span id="res_total">0.00</span></div>
             </div>
             <div class="mt-8 bg-white/10 px-4 py-1 rounded-full text-xs font-mono">Unitario Edif: <span id="res_unit" class="text-[#FFC72C] font-bold">0.00</span> S/m²</div>
          </div>
       </div>
    </div>
  </div>

  <div id="view-presupuesto" class="view-section bg-slate-200">
    <nav class="bg-white shadow p-3 border-b-4 border-[#002855] flex justify-between items-center sticky top-0 z-[2000]">
       <div class="flex items-center gap-3">
         <span class="bg-[#002855] text-[#FFC72C] px-3 py-1 font-bold text-xl rounded">3</span>
         <h2 class="text-[#002855] font-bold text-lg hidden md:block">PRESUPUESTO DE OBRA</h2>
       </div>
       <button onclick="goHome()" class="bg-[#DA291C] text-white px-4 py-2 rounded font-bold text-xs uppercase shadow hover:bg-red-700 transition">Volver al Menú</button>
    </nav>

    <div class="flex-1 w-full max-w-7xl mx-auto p-4 grid md:grid-cols-12 gap-6 h-[calc(100vh-80px)]">
       <div class="md:col-span-5 bg-white rounded-xl shadow border border-slate-300 flex flex-col overflow-hidden">
          <div class="p-4 bg-slate-50 border-b"><h3 class="font-bold text-[#002855] text-xs uppercase">Datos y Parámetros</h3></div>
          <div class="flex-1 overflow-y-auto custom-scroll p-5 space-y-6">
             
             <div>
                <label class="text-xs font-black text-[#002855] uppercase border-b block pb-1 mb-2">Datos Generales de la Obra</label>
                <div class="grid grid-cols-2 gap-4">
                   <div><label class="text-[10px] font-bold block">ÁREA TECHADA (m²)</label><input type="number" id="t3_area" value="100" oninput="t3_calc()" class="w-full p-2 input-nyc rounded text-center font-bold"></div>
                   <div><label class="text-[10px] font-bold block">N° PISOS</label><input type="number" id="t3_pisos" value="1" oninput="t3_calc()" class="w-full p-2 input-nyc rounded text-center font-bold"></div>
                   <div class="col-span-2"><label class="text-[10px] font-bold block">USO DE LA EDIFICACIÓN</label><select class="w-full p-2 input-nyc rounded text-xs"><option>Vivienda Unifamiliar</option><option>Vivienda Multifamiliar</option><option>Comercio / Oficinas</option><option>Salud / Educación</option></select></div>
                </div>
             </div>

             <div>
                <label class="text-xs font-black text-[#002855] uppercase border-b block pb-1 mb-2">Gastos Generales y Utilidad</label>
                <div class="grid grid-cols-2 gap-4">
                   <div><label class="text-[10px] font-bold block">GASTOS GRAL (%)</label><input type="number" id="t3_gg" value="15" oninput="t3_calc()" class="w-full p-2 input-nyc rounded text-center font-bold"></div>
                   <div><label class="text-[10px] font-bold block">UTILIDAD (%)</label><input type="number" id="t3_util" value="10" oninput="t3_calc()" class="w-full p-2 input-nyc rounded text-center font-bold"></div>
                </div>
             </div>

             <div>
                <label class="text-xs font-black text-[#002855] uppercase border-b block pb-1 mb-2">7 Valores por Partidas (S/m²)</label>
                <div id="t3_cats_container" class="space-y-3"></div>
             </div>
          </div>
          <div class="p-4 bg-slate-50 border-t">
             <button onclick="t3_reset()" class="w-full py-2 bg-slate-200 text-slate-600 rounded text-xs font-bold hover:bg-red-100 hover:text-red-500">REINICIAR PRESUPUESTO</button>
          </div>
       </div>

       <div class="md:col-span-7 bg-[#002855] text-white rounded-xl shadow-2xl p-8 flex flex-col justify-center items-center text-center border-t-8 border-[#FFC72C]">
          <h4 class="text-[#FFC72C] font-campaign text-3xl mb-8 tracking-widest">COSTO TOTAL OBRA</h4>
          <div class="w-full space-y-4 text-sm mb-8 border-b border-white/10 pb-8">
             <div class="flex justify-between"><span>Costo Directo</span><span id="t3_cd" class="font-mono font-bold">S/ 0.00</span></div>
             <div class="flex justify-between text-slate-300"><span>Gastos Generales</span><span id="t3_res_gg" class="font-mono">S/ 0.00</span></div>
             <div class="flex justify-between text-slate-300"><span>Utilidad</span><span id="t3_res_util" class="font-mono">S/ 0.00</span></div>
          </div>
          <div class="text-6xl font-bold font-campaign drop-shadow-lg text-white">
             <span class="text-2xl opacity-50 align-top">S/.</span><span id="t3_total">0.00</span>
          </div>
          <p class="text-[10px] text-slate-400 mt-4">* Estimación referencial para obra nueva.</p>
       </div>
    </div>
  </div>

  <script>
    /* --- NAVEGACIÓN --- */
    function switchView(id) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0,0);
    }
    function goHome() { switchView('view-landing'); }

    /* --- T1: ARANCELES --- */
    let allFeatures = [];
    function initT1() {
        fetch('distritos_mef_2026_con_zip.geojson')
        .then(r => r.json())
        .then(data => {
            allFeatures = data.features;
            document.getElementById('t1_list').innerHTML = '<div class="text-center p-10 text-xs text-slate-400">Datos cargados. Inicia la búsqueda.</div>';
        })
        .catch(e => document.getElementById('t1_list').innerHTML = '<div class="text-center p-4 text-red-500 text-xs font-bold">⚠️ No se encontró el archivo GeoJSON.</div>');

        document.getElementById('t1_search').addEventListener('input', (e) => {
            const q = e.target.value.toUpperCase();
            if(q.length < 2) return;
            const res = allFeatures.filter(f => {
                const p = f.properties;
                const d = p.distrito || p.NOMBDIST || "";
                const u = p.ubigeo || p.UBIGEO || "";
                return d.includes(q) || u.startsWith(q);
            }).slice(0,50);

            document.getElementById('t1_list').innerHTML = res.map(r => {
                const p = r.properties;
                return `<div class="bg-white border p-3 rounded mb-2 hover:border-[#002855] group shadow-sm transition">
                   <div class="flex justify-between items-center">
                      <div><div class="font-bold text-[#002855] text-sm">${p.distrito||p.NOMBDIST}</div><div class="text-[10px] text-slate-500">UBIGEO: ${p.ubigeo||p.UBIGEO}</div></div>
                      ${p.mef_zip_url ? `<a href="${p.mef_zip_url}" target="_blank" class="text-[10px] bg-[#DA291C] text-white px-3 py-1.5 rounded font-bold hover:bg-red-700 shadow"><i class="fa-solid fa-download mr-1"></i> PLANO</a>` : '<span class="text-xs text-slate-300">Sin Link</span>'}
                   </div>
                </div>`;
            }).join('');
            document.getElementById('t1_count').innerText = `${res.length} encontrados`;
        });
    }
    window.addEventListener('load', initT1);

    /* --- T2: EDIFICACIÓN --- */
    // Solo 3 Componentes solicitados
    const T2_CATS_LIMITED = [
        {l:"1. Muros y Columnas",opts:[{l:"A. Estructuras laminares de concreto armado, muros de concreto armado con una longitud total mayor a 40% del perímetro.",v:1050.50},{l:"B. Pórticos de concreto armado con ladrillo, columnas y vigas de concreto armado.",v:750.20},{l:"C. Placas de concreto (Albañilería Armada), bloques de concreto o ladrillo con columnas y vigas de amarre.",v:520.10},{l:"D. Ladrillo o bloque de concreto sin confinamiento (Sistema aporticado o autoconstrucción).",v:310.00},{l:"E. Adobe, tapial, quincha o madera.",v:180.50}]},
        {l:"2. Techos",opts:[{l:"A. Losa de concreto armado horizontal o inclinada con luces mayores a 6.00m.",v:480.00},{l:"B. Aligerado o losa de concreto armado horizontal o inclinada con luces menores o iguales a 6.00m.",v:320.40},{l:"C. Calamina metálica, fibrocemento o teja sobre viguería metálica o de madera.",v:150.20},{l:"D. Madera rústica, caña con torta de barro, estera.",v:60.00}]},
        {l:"3. Puertas y Ventanas",opts:[{l:"A. Aluminio pesado con perfiles especiales, madera selecta (Caoba, Cedro) con diseños especiales.",v:250.00},{l:"B. Aluminio sistema mod, madera nacional (Tornillo) barnizada, vidrio templado o laminado.",v:140.00},{l:"C. Fierro, perfiles de acero, madera corriente pintada.",v:80.00},{l:"D. Sin puertas ni ventanas, o vanos cerrados con material precario.",v:0.00}]}
    ];

    // Lista Completa 96 Obras
    const MASTER_OBRAS_LIST = [
        {id: 1, name: "Muro concreto armado, e=0.25m h=2.40m", unit: "m2", prices: {lima: 453.45, costa: 443.89, sierra: 444.14, selva: 457.72}},
        {id: 2, name: "Muro traslúcido (tipo UNI) / metálico h=2.40m", unit: "m2", prices: {lima: 417.73, costa: 408.92, sierra: 409.15, selva: 421.66}},
        {id: 3, name: "Muro ladrillo tarrajeado, col. concreto h>2.40m", unit: "m2", prices: {lima: 383.77, costa: 375.68, sierra: 375.89, selva: 387.38}},
        {id: 4, name: "Muro ladrillo tarrajeado, col. concreto h<=2.40m", unit: "m2", prices: {lima: 336.07, costa: 328.99, sierra: 329.17, selva: 339.24}},
        {id: 5, name: "Muro ladrillo solaqueado, col. concreto h<=2.40m", unit: "m2", prices: {lima: 281.01, costa: 275.09, sierra: 275.24, selva: 283.66}},
        {id: 6, name: "Cerco de fierro/aluminio", unit: "m2", prices: {lima: 206.30, costa: 201.95, sierra: 202.06, selva: 208.24}},
        {id: 7, name: "Muro ladrillo soga, cimentación", unit: "m2", prices: {lima: 235.30, costa: 230.34, sierra: 230.47, selva: 237.52}},
        {id: 8, name: "Muro adobe, tapial o quincha tarrajeado", unit: "m2", prices: {lima: 150.76, costa: 147.58, sierra: 147.66, selva: 152.18}},
        {id: 9, name: "Muro ladrillo cabeza, col. concreto h<=2.40m", unit: "m2", prices: {lima: 408.56, costa: 399.95, sierra: 400.17, selva: 412.41}},
        {id: 10, name: "Puerta fierro/aluminio h=2.20m ancho<=2.00m", unit: "m2", prices: {lima: 618.00, costa: 604.98, sierra: 605.31, selva: 623.83}},
        {id: 11, name: "Puerta fierro plancha h=2.20m ancho>2.00m", unit: "m2", prices: {lima: 590.41, costa: 577.96, sierra: 578.28, selva: 595.97}},
        {id: 12, name: "Portón fierro plancha h>3.00m hasta 4.00m", unit: "m2", prices: {lima: 427.48, costa: 418.47, sierra: 418.70, selva: 468.54}},
        {id: 13, name: "Puerta madera h=2.20m ancho<=2.00m", unit: "m2", prices: {lima: 449.15, costa: 439.68, sierra: 439.92, selva: 483.88}},
        {id: 14, name: "Puerta madera h=2.20m ancho>2.00m", unit: "m2", prices: {lima: 404.21, costa: 395.68, sierra: 395.90, selva: 435.47}},
        {id: 15, name: "Portón fierro plancha h<=3.00m", unit: "m2", prices: {lima: 360.87, costa: 353.26, sierra: 353.46, selva: 394.83}},
        {id: 16, name: "Portón fierro plancha h>4.00m", unit: "m2", prices: {lima: 321.02, costa: 314.25, sierra: 314.43, selva: 351.30}},
        {id: 17, name: "Tanque elevado concreto <= 5m3", unit: "m3", prices: {lima: 1316.09, costa: 1288.35, sierra: 1289.07, selva: 1328.49}},
        {id: 18, name: "Tanque elevado plástico/fibra > 1m3", unit: "m3", prices: {lima: 1439.21, costa: 1408.88, sierra: 1409.66, selva: 1452.77}},
        {id: 19, name: "Tanque elevado concreto > 5m3", unit: "m3", prices: {lima: 1103.04, costa: 1079.79, sierra: 1080.39, selva: 1113.43}},
        {id: 20, name: "Tanque elevado concreto > 15m3", unit: "m3", prices: {lima: 977.16, costa: 956.56, sierra: 957.09, selva: 986.37}},
        {id: 21, name: "Tanque elevado plástico/fibra <= 1m3", unit: "m3", prices: {lima: 1083.70, costa: 1060.86, sierra: 1061.45, selva: 1093.91}},
        {id: 22, name: "Cisterna plástico/fibra > 1m3", unit: "m3", prices: {lima: 1483.42, costa: 1452.15, sierra: 1452.95, selva: 1497.39}},
        {id: 23, name: "Cisterna concreto <= 5m3", unit: "m3", prices: {lima: 1488.89, costa: 1457.50, sierra: 1458.31, selva: 1502.91}},
        {id: 24, name: "Cisterna concreto <= 10m3", unit: "m3", prices: {lima: 1241.37, costa: 1215.21, sierra: 1215.88, selva: 1253.07}},
        {id: 25, name: "Cisterna concreto <= 20m3", unit: "m3", prices: {lima: 1092.61, costa: 1069.58, sierra: 1070.17, selva: 1102.90}},
        {id: 26, name: "Cisterna, pozo ladrillo tarrajeado <= 5m3", unit: "m3", prices: {lima: 1176.91, costa: 1152.10, sierra: 1152.74, selva: 1188.00}},
        {id: 27, name: "Cisterna concreto > 20m3", unit: "m3", prices: {lima: 901.92, costa: 882.91, sierra: 883.40, selva: 910.42}},
        {id: 28, name: "Tanque plástico/fibra <= 1m3", unit: "m3", prices: {lima: 904.36, costa: 885.30, sierra: 885.79, selva: 912.88}},
        {id: 29, name: "Piscina concreto c/mayólica <= 5m3", unit: "m3", prices: {lima: 1483.41, costa: 1452.14, sierra: 1452.94, selva: 1497.38}},
        {id: 30, name: "Piscina concreto c/mayólica <= 10m3", unit: "m3", prices: {lima: 1236.70, costa: 1210.63, sierra: 1211.30, selva: 1248.35}},
        {id: 31, name: "Piscina concreto c/mayólica > 10m3", unit: "m3", prices: {lima: 1182.92, costa: 1157.99, sierra: 1158.63, selva: 1194.07}},
        {id: 32, name: "Piscina ladrillo KK c/pintura", unit: "m3", prices: {lima: 1019.30, costa: 997.81, sierra: 998.37, selva: 1028.90}},
        {id: 33, name: "Losa concreto armado e=4\"", unit: "m2", prices: {lima: 170.50, costa: 166.91, sierra: 167.00, selva: 172.11}},
        {id: 34, name: "Asfalto e=2\"", unit: "m2", prices: {lima: 141.85, costa: 138.86, sierra: 138.93, selva: 143.18}},
        {id: 35, name: "Losa concreto simple e=4\"", unit: "m2", prices: {lima: 136.11, costa: 133.25, sierra: 133.32, selva: 137.40}},
        {id: 36, name: "Vereda concreto e=4\"", unit: "m2", prices: {lima: 107.31, costa: 105.05, sierra: 105.10, selva: 108.32}},
        {id: 37, name: "Horno concreto armado/refractario", unit: "m3", prices: {lima: 1596.70, costa: 1563.04, sierra: 1563.91, selva: 1611.74}},
        {id: 38, name: "Horno ladrillo/refractario", unit: "m3", prices: {lima: 1346.81, costa: 1318.42, sierra: 1319.15, selva: 1359.50}},
        {id: 39, name: "Horno adobe", unit: "m3", prices: {lima: 402.14, costa: 393.67, sierra: 393.88, selva: 405.93}},
        {id: 40, name: "Torre de vigilancia (concreto)", unit: "und", prices: {lima: 7081.57, costa: 6932.30, sierra: 6936.14, selva: 7148.29}},
        {id: 41, name: "Estructura concreto (sin torre)", unit: "und", prices: {lima: 4208.44, costa: 4119.73, sierra: 4122.01, selva: 4248.09}},
        {id: 42, name: "Bóveda concreto armado reforzado", unit: "m3", prices: {lima: 1529.53, costa: 1497.29, sierra: 1498.12, selva: 1543.94}},
        {id: 43, name: "Balanza industrial concreto", unit: "m3", prices: {lima: 869.64, costa: 851.31, sierra: 851.78, selva: 877.84}},
        {id: 44, name: "Poste concreto/fierro con reflector", unit: "und", prices: {lima: 2583.43, costa: 2528.97, sierra: 2530.37, selva: 2607.76}},
        {id: 45, name: "Dados concreto (soporte máquinas)", unit: "m3", prices: {lima: 1808.83, costa: 1770.71, sierra: 1771.69, selva: 1825.88}},
        {id: 46, name: "Caja registro 24\"x24\"", unit: "und", prices: {lima: 342.64, costa: 335.41, sierra: 335.60, selva: 345.86}},
        {id: 47, name: "Caja registro 12\"x24\"", unit: "und", prices: {lima: 332.67, costa: 325.66, sierra: 325.84, selva: 335.80}},
        {id: 48, name: "Caja registro 10\"x20\"", unit: "und", prices: {lima: 284.29, costa: 278.30, sierra: 278.46, selva: 286.97}},
        {id: 49, name: "Buzón de concreto standard", unit: "und", prices: {lima: 2518.08, costa: 2465.00, sierra: 2466.37, selva: 2541.80}},
        {id: 50, name: "Parapeto ladrillo cabeza tarrajeado", unit: "m2", prices: {lima: 243.42, costa: 238.29, sierra: 238.42, selva: 245.71}},
        {id: 51, name: "Parapeto ladrillo soga tarrajeado", unit: "m2", prices: {lima: 197.06, costa: 192.91, sierra: 193.01, selva: 198.92}},
        {id: 52, name: "Parapeto ladrillo cabeza caravista", unit: "m2", prices: {lima: 169.09, costa: 165.52, sierra: 180.02, selva: 170.68}},
        {id: 53, name: "Parapeto ladrillo soga caravista", unit: "m2", prices: {lima: 111.12, costa: 108.78, sierra: 108.84, selva: 112.17}},
        {id: 54, name: "Escalera concreto armado c/acabados", unit: "m3", prices: {lima: 6133.92, costa: 6004.63, sierra: 6007.96, selva: 6191.71}},
        {id: 55, name: "Escalera concreto armado s/acabados", unit: "m3", prices: {lima: 4954.27, costa: 4849.84, sierra: 4852.53, selva: 5000.95}},
        {id: 56, name: "Rampa/Grada concreto c/encofrado", unit: "m3", prices: {lima: 2126.08, costa: 2081.27, sierra: 2082.42, selva: 2146.11}},
        {id: 57, name: "Rampa concreto s/encofrado", unit: "m3", prices: {lima: 1735.70, costa: 1699.11, sierra: 1700.05, selva: 1752.05}},
        {id: 58, name: "Muro contención concreto h=1.40m e=20cm", unit: "m3", prices: {lima: 1516.06, costa: 1484.10, sierra: 1484.92, selva: 1530.34}},
        {id: 59, name: "Muro contención concreto h=2.50m e=20cm", unit: "m3", prices: {lima: 1345.55, costa: 1317.19, sierra: 1317.92, selva: 1358.23}},
        {id: 60, name: "Muro contención concreto h=4.00m e=20cm", unit: "m3", prices: {lima: 1317.51, costa: 1289.74, sierra: 1290.45, selva: 1329.92}},
        {id: 61, name: "Muro contención concreto h=1.40m e=15cm", unit: "m3", prices: {lima: 1313.51, costa: 1285.82, sierra: 1286.53, selva: 1325.88}},
        {id: 62, name: "Muro contención concreto h=2.50m e=15cm", unit: "m3", prices: {lima: 1125.98, costa: 1102.24, sierra: 1102.86, selva: 1136.59}},
        {id: 63, name: "Muro contención concreto h=4.00m e=15cm", unit: "m3", prices: {lima: 1091.29, costa: 1068.29, sierra: 1068.88, selva: 1101.58}},
        {id: 64, name: "Escalera caracol metálica h=6.00m", unit: "und", prices: {lima: 9041.42, costa: 8850.84, sierra: 8855.75, selva: 9126.61}},
        {id: 65, name: "Escalera caracol metálica h=3.00m", unit: "und", prices: {lima: 4749.91, costa: 4649.79, sierra: 4652.37, selva: 4794.66}},
        {id: 66, name: "Escalera caracol metálica h=3.00m (entre pisos)", unit: "und", prices: {lima: 4291.51, costa: 4201.05, sierra: 4203.38, selva: 4331.95}},
        {id: 67, name: "Pastorales h=2.20m", unit: "und", prices: {lima: 519.47, costa: 508.52, sierra: 508.80, selva: 524.37}},
        {id: 68, name: "Proyector luminaria 250W vapor sodio", unit: "und", prices: {lima: 1054.39, costa: 1032.16, sierra: 1032.74, selva: 1064.32}},
        {id: 69, name: "Proyector luminaria 150W vapor mercurio", unit: "und", prices: {lima: 980.80, costa: 960.13, sierra: 960.66, selva: 990.04}},
        {id: 70, name: "Tubería concreto armado D=1.20m", unit: "ml", prices: {lima: 583.29, costa: 570.99, sierra: 571.31, selva: 588.78}},
        {id: 71, name: "Tubería concreto D=18\" (45cm)", unit: "ml", prices: {lima: 369.50, costa: 361.71, sierra: 361.91, selva: 372.98}},
        {id: 72, name: "Canaleta de concreto sin rejillas", unit: "ml", prices: {lima: 82.97, costa: 81.22, sierra: 81.27, selva: 83.75}},
        {id: 73, name: "Zanja concreto armado (talleres)", unit: "ml", prices: {lima: 926.72, costa: 907.19, sierra: 907.69, selva: 935.45}},
        {id: 74, name: "Poste concreto 12.00m + reflector", unit: "pza", prices: {lima: 5117.80, costa: 5009.92, sierra: 5012.70, selva: 5166.01}},
        {id: 75, name: "Poste concreto 11.00m + reflector", unit: "pza", prices: {lima: 4199.26, costa: 4110.74, sierra: 4113.02, selva: 4238.82}},
        {id: 76, name: "Poste concreto 10.00m + reflector", unit: "pza", prices: {lima: 3629.07, costa: 3552.58, sierra: 3554.55, selva: 3663.26}},
        {id: 77, name: "Poste concreto 9.00m + reflector", unit: "pza", prices: {lima: 3001.16, costa: 2937.90, sierra: 2939.53, selva: 3029.44}},
        {id: 78, name: "Poste concreto 8.00m + reflector", unit: "pza", prices: {lima: 2583.43, costa: 2528.97, sierra: 2530.37, selva: 2607.76}},
        {id: 79, name: "Poste concreto 7.00m + reflector", unit: "pza", prices: {lima: 2110.21, costa: 2065.73, sierra: 2066.88, selva: 2130.10}},
        {id: 80, name: "Poste concreto 3.00m + reflector", unit: "pza", prices: {lima: 964.46, costa: 944.13, sierra: 944.66, selva: 973.55}},
        {id: 81, name: "Cubierta tejas arcilla o similar", unit: "m2", prices: {lima: 134.24, costa: 140.27, sierra: 142.91, selva: 144.61}},
        {id: 82, name: "Cubierta ladrillo pastelero mezcla 1:5", unit: "m2", prices: {lima: 77.08, costa: 75.46, sierra: 75.50, selva: 77.81}},
        {id: 83, name: "Cubierta ladrillo pastelero barro", unit: "m2", prices: {lima: 73.84, costa: 72.28, sierra: 72.32, selva: 74.53}},
        {id: 84, name: "Cubierta torta de barro 2\"", unit: "m2", prices: {lima: 42.02, costa: 41.13, sierra: 41.16, selva: 42.42}},
        {id: 85, name: "Pasamano metálico tubo 3\"", unit: "ml", prices: {lima: 412.34, costa: 403.64, sierra: 403.87, selva: 416.22}},
        {id: 86, name: "Pasamano metálico tubo 2\"", unit: "ml", prices: {lima: 225.61, costa: 220.85, sierra: 220.98, selva: 227.74}},
        {id: 87, name: "Pasamano metálico tubo 1\"", unit: "ml", prices: {lima: 171.03, costa: 167.42, sierra: 167.52, selva: 172.64}},
        {id: 88, name: "Cerco metálico tubo 2\", malla #8", unit: "m2", prices: {lima: 242.15, costa: 237.04, sierra: 237.18, selva: 244.43}},
        {id: 89, name: "Cerco metálico tubo 2\", malla #10", unit: "m2", prices: {lima: 224.45, costa: 219.72, sierra: 219.84, selva: 226.56}},
        {id: 90, name: "Cerco metálico tubo 2\", malla #12", unit: "m2", prices: {lima: 201.44, costa: 197.19, sierra: 197.30, selva: 203.34}},
        {id: 91, name: "Poste/estructura fierro h=4m", unit: "pza", prices: {lima: 535.62, costa: 524.33, sierra: 524.62, selva: 540.66}},
        {id: 92, name: "Poste/estructura fierro h=2.50m", unit: "pza", prices: {lima: 313.28, costa: 306.68, sierra: 306.85, selva: 316.23}},
        {id: 93, name: "Sardinel concreto e=0.15m h=0.35 s/pintura", unit: "ml", prices: {lima: 128.50, costa: 125.79, sierra: 125.86, selva: 129.71}},
        {id: 94, name: "Sardinel concreto e=0.15m h=0.35 c/pintura", unit: "ml", prices: {lima: 141.17, costa: 138.19, sierra: 138.27, selva: 142.50}},
        {id: 95, name: "Pista o losa de concreto 6\"", unit: "m2", prices: {lima: 197.92, costa: 193.75, sierra: 193.86, selva: 199.78}},
        {id: 96, name: "Trampa de concreto armado para grasa", unit: "m3", prices: {lima: 1356.39, costa: 1327.80, sierra: 1328.54, selva: 1369.17}}
    ];

    let t2_added = [];

    function t2_refresh() {
        const reg = document.getElementById('t2_region').value;
        const regFactors = {lima:1, costa:0.9, sierra:0.85, selva:0.95};
        const f = regFactors[reg];

        const cont = document.getElementById('t2_cats_list');
        cont.innerHTML = '';
        T2_CATS_LIMITED.forEach(cat => {
            let ops = `<option value="0">-- Seleccionar --</option>`;
            cat.opts.forEach(o => ops += `<option value="${(o.v*f).toFixed(2)}">${o.l} - S/ ${(o.v*f).toFixed(2)}</option>`);
            cont.innerHTML += `<div class="mb-2 border-b border-slate-100 pb-1"><p class="text-[10px] font-bold text-slate-500 uppercase">${cat.l}</p><select class="t2-sel w-full p-1 border rounded text-xs text-[#002855] font-bold" onchange="t2_calc()">${ops}</select></div>`;
        });

        const obSel = document.getElementById('t2_obra_sel');
        obSel.innerHTML = MASTER_OBRAS_LIST.map(o => {
            const p = o.prices[reg] || 0;
            return `<option value="${p}" data-n="${o.name}">${o.name} - S/ ${p.toFixed(2)}</option>`;
        }).join('');
        t2_calc();
    }

    function t2_calc() {
        let unit = 0;
        document.querySelectorAll('.t2-sel').forEach(s => unit += parseFloat(s.value));
        
        const age = document.getElementById('t2_ant').value;
        const mat = document.getElementById('t2_mat').value;
        const est = document.getElementById('t2_est').value;
        let dep = Math.min((age * (mat==='adobe'?2:1) + {'muy_bueno':0,'bueno':5,'regular':15,'malo':50}[est]), 80);
        document.getElementById('t2_deprec_val').innerText = dep.toFixed(0) + "%";

        const area = document.getElementById('t2_area').value;
        const subEdif = unit * area * (1 - dep/100);
        const subObras = t2_added.reduce((a,b)=>a+b.t,0);
        const terr = parseFloat(document.getElementById('t2_val_terreno').value) || 0;

        document.getElementById('res_edif').innerText = "S/ " + subEdif.toLocaleString('es-PE',{minimumFractionDigits:2});
        document.getElementById('res_obras').innerText = "S/ " + subObras.toLocaleString('es-PE',{minimumFractionDigits:2});
        document.getElementById('res_terreno').innerText = "S/ " + terr.toLocaleString('es-PE',{minimumFractionDigits:2});
        document.getElementById('res_total').innerText = (subEdif+subObras+terr).toLocaleString('es-PE',{minimumFractionDigits:2});
        document.getElementById('res_unit').innerText = unit.toFixed(2);
    }

    function t2_addObra() {
        const sel = document.getElementById('t2_obra_sel');
        const qty = parseFloat(document.getElementById('t2_obra_qty').value);
        if(qty>0) {
            const name = sel.options[sel.selectedIndex].getAttribute('data-n');
            const val = parseFloat(sel.value);
            t2_added.push({id:Date.now(), n:name, q:qty, t:val*qty});
            renderAdded();
            t2_calc();
            document.getElementById('t2_obra_qty').value='';
        }
    }

    function renderAdded() {
        document.getElementById('t2_added_list').innerHTML = t2_added.map(x => `<div class="flex justify-between bg-white p-1 border rounded text-[10px]"><span><b>${x.n}</b> (x${x.q})</span><div class="flex items-center gap-2"><span class="font-bold text-blue-800">S/${x.t.toFixed(0)}</span><button onclick="delObra(${x.id})" class="text-red-500">X</button></div></div>`).join('');
    }
    function delObra(id) { t2_added=t2_added.filter(x=>x.id!==id); renderAdded(); t2_calc(); }
    function t2_reset() { t2_added=[]; renderAdded(); document.querySelectorAll('select').forEach(s=>s.selectedIndex=0); document.getElementById('t2_area').value=100; document.getElementById('t2_val_terreno').value=''; t2_refresh(); }
    window.addEventListener('load', t2_refresh);

    // --- T3: PRESUPUESTO (VANILLA) ---
    const T3_DATA = [
        {l:"1. Muros y Columnas",opts:[{l:"A. Concreto...",v:600},{l:"B. Ladrillo...",v:400},{l:"C. Drywall...",v:250},{l:"D. Adobe...",v:100},{l:"E. Tapial...",v:80},{l:"F. Madera...",v:120},{l:"G. Quincha...",v:70},{l:"H. Piedra...",v:90},{l:"I. Otro...",v:50}]},
        {l:"2. Techos",opts:[{l:"A. Losa...",v:300},{l:"B. Aligerado...",v:200},{l:"C. Calamina...",v:100},{l:"D. Teja...",v:80},{l:"E. Paja...",v:20},{l:"F. Caña...",v:15},{l:"G. Madera...",v:50},{l:"H. Precario...",v:5},{l:"I. Sin...",v:0}]},
        {l:"3. Pisos",opts:[{l:"A. Marmol...",v:150},{l:"B. Parquet...",v:120},{l:"C. Ceramico...",v:80},{l:"D. Cemento...",v:40},{l:"E. Tierra...",v:10},{l:"F. Madera...",v:100},{l:"G. Asfalto...",v:30},{l:"H. Piedra...",v:20},{l:"I. Otro...",v:5}]},
        {l:"4. Puertas y Ventanas",opts:[{l:"A. Aluminio...",v:150},{l:"B. Vidrio...",v:100},{l:"C. Fierro...",v:80},{l:"D. Madera...",v:90},{l:"E. Contraplacada...",v:50},{l:"F. Simple...",v:30},{l:"G. Sin...",v:0},{l:"H. Reja...",v:40},{l:"I. Malla...",v:10}]},
        {l:"5. Revestimientos",opts:[{l:"A. Fino...",v:120},{l:"B. Tarrajeo...",v:80},{l:"C. Simple...",v:50},{l:"D. Sin...",v:0},{l:"E. Estuco...",v:70},{l:"F. Madera...",v:90},{l:"G. Piedra...",v:40},{l:"H. Solaqueo...",v:20},{l:"I. Barro...",v:10}]},
        {l:"6. Baños",opts:[{l:"A. Lujo...",v:150},{l:"B. Std...",v:80},{l:"C. Basico...",v:40},{l:"D. Sin...",v:0},{l:"E. Importado...",v:180},{l:"F. Nacional...",v:60},{l:"G. Blanco...",v:50},{l:"H. Color...",v:55},{l:"I. Letrina...",v:10}]},
        {l:"7. Instalaciones",opts:[{l:"A. Completas...",v:180},{l:"B. Basicas...",v:100},{l:"C. Minimas...",v:50},{l:"D. Sin...",v:0},{l:"E. Trifasica...",v:120},{l:"F. Monofasica...",v:40},{l:"G. Gas...",v:80},{l:"H. Redes...",v:60},{l:"I. Pozo...",v:20}]}
    ];

    function t3_init() {
        const cont = document.getElementById('t3_cats_container');
        cont.innerHTML = T3_DATA.map(c => {
            let ops = `<option value="0">-- Seleccionar --</option>`;
            c.opts.forEach(o => ops += `<option value="${o.v}">${o.l} (S/ ${o.v})</option>`);
            return `<div><label class="text-[10px] font-bold text-slate-500 uppercase">${c.l}</label><select class="t3-sel w-full p-1 border rounded text-xs" onchange="t3_calc()">${ops}</select></div>`;
        }).join('');
        t3_calc();
    }

    function t3_calc() {
        const area = parseFloat(document.getElementById('t3_area').value) || 0;
        const pisos = parseFloat(document.getElementById('t3_pisos').value) || 1;
        const gg = parseFloat(document.getElementById('t3_gg').value) || 0;
        const util = parseFloat(document.getElementById('t3_util').value) || 0;

        let unit = 0;
        document.querySelectorAll('.t3-sel').forEach(s => unit += parseFloat(s.value));
        
        const cd = unit * area * (pisos>=5 ? 1.05 : 1.0);
        const total = cd * (1 + (gg+util)/100);

        document.getElementById('t3_cd').innerText = "S/ " + cd.toLocaleString();
        document.getElementById('t3_res_gg').innerText = "S/ " + (cd*gg/100).toLocaleString();
        document.getElementById('t3_res_util').innerText = "S/ " + (cd*util/100).toLocaleString();
        document.getElementById('t3_total').innerText = total.toLocaleString(undefined, {maximumFractionDigits:0});
    }

    function t3_reset() {
        document.querySelectorAll('.t3-sel').forEach(s => s.selectedIndex=0);
        document.getElementById('t3_area').value=100;
        t3_calc();
    }
    
    window.addEventListener('load', t3_init);
  </script>
</body>
</html>
