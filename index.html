<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Plataforma Técnica de Valoración Urbana 2026</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
  
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            heading: ['Oswald', 'sans-serif'],
          },
          colors: {
            brand: {
              blue: '#002855',
              yellow: '#FFC72C',
              red: '#DA291C',
              dark: '#0f172a'
            }
          },
          boxShadow: {
            'glow': '0 0 20px rgba(0, 40, 85, 0.15)',
            'float': '0 10px 30px -10px rgba(0,0,0,0.3)'
          }
        }
      }
    }
  </script>
 
  <style>
    /* ESTILOS BASE Y ANIMACIONES */
    body { 
        background-color: #f8fafc; 
        color: #334155; 
        -webkit-font-smoothing: antialiased; 
        /* Prevenir rebote en iOS */
        overscroll-behavior-y: none;
    }
    
    .view-section { 
        display: none; 
        min-height: 100vh; 
        flex-direction: column; 
        animation: fadeIn 0.4s ease-out; 
    }
    .view-section.active { display: flex; }
    
    @keyframes fadeIn { 
        from{opacity:0; transform: translateY(15px);} 
        to{opacity:1; transform: translateY(0);} 
    }
 
    /* Tarjetas del menú principal */
    .menu-card { 
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); 
    }
    .menu-card:active { transform: scale(0.98); }
    @media(hover: hover) {
        .menu-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 20px 40px -5px rgba(0, 40, 85, 0.15);
            border-color: #DA291C;
        }
    }
 
    /* Inputs Modernos & Táctiles */
    input, select { 
      outline: none; 
      transition: all 0.2s ease; 
      appearance: none; 
      background-image: none;
      font-size: 16px; /* Evita zoom en iOS */
    }
    select {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 0.75rem center;
        background-repeat: no-repeat;
        background-size: 1.5em 1.5em;
    }
    input:focus, select:focus { 
      border-color: #002855; 
      box-shadow: 0 0 0 3px rgba(0, 40, 85, 0.1); 
      background-color: #fff;
    }
    
    /* Scrollbar Personalizado */
    .custom-scroll::-webkit-scrollbar { width: 5px; }
    .custom-scroll::-webkit-scrollbar-track { background: transparent; }
    .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    
    /* Utilidades extra */
    .glass-header {
      background: rgba(255, 255, 255, 0.90);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }

    /* Padding seguro para móviles (iPhone X+) */
    .safe-pb { padding-bottom: env(safe-area-inset-bottom); }
    .safe-pt { padding-top: env(safe-area-inset-top); }
  </style>
</head>
<body class="selection:bg-brand-blue selection:text-white pb-0 mb-0">
 
  <div id="view-landing" class="view-section active">
    <header class="bg-brand-blue relative overflow-hidden pb-16 pt-20 px-6 text-center shadow-xl rounded-b-[2.5rem]">
      <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-brand-red via-brand-yellow to-brand-red"></div>
      
      <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
          <div class="absolute -top-20 -left-20 w-80 h-80 bg-blue-500 rounded-full mix-blend-overlay filter blur-[80px] opacity-30 animate-pulse"></div>
          <div class="absolute bottom-0 right-0 w-64 h-64 bg-brand-red rounded-full mix-blend-overlay filter blur-[80px] opacity-20"></div>
      </div>
      
      <div class="relative z-10 max-w-4xl mx-auto mt-4">
        <h1 class="text-5xl md:text-7xl font-bold font-heading text-white mb-2 tracking-wide leading-tight">
          VALORACIÓN <br class="md:hidden"/> <span class="text-brand-yellow">URBANA</span>
        </h1>
        <div class="h-1.5 w-24 bg-brand-red mx-auto mb-6 rounded-full"></div>
        <p class="text-sm md:text-xl text-blue-100 font-light tracking-[0.2em] uppercase">Herramientas Técnicas 2026</p>
      </div>
    </header>
 
    <main class="flex-1 max-w-7xl mx-auto w-full p-4 md:p-6 -mt-10 relative z-20 pb-10">
      <div class="grid md:grid-cols-3 gap-4 lg:gap-8">
        <div onclick="switchView('view-terreno')" class="menu-card bg-white p-6 md:p-8 rounded-2xl shadow-glow border border-white cursor-pointer flex flex-row md:flex-col items-center gap-4 md:gap-0 h-full group relative overflow-hidden">
            <div class="absolute right-0 top-0 p-4 opacity-5 md:opacity-100 md:static">
                 <div class="w-16 h-16 md:w-20 md:h-20 bg-blue-50 rounded-2xl md:rounded-full flex items-center justify-center md:mb-6 group-hover:bg-brand-blue transition-colors duration-300">
                    <i class="fa-solid fa-map-location-dot text-2xl md:text-3xl text-brand-blue group-hover:text-brand-yellow"></i>
                 </div>
            </div>
            <div class="flex-1 text-left md:text-center z-10">
                <h2 class="text-xl md:text-2xl font-bold text-slate-800 font-heading mb-1 md:mb-3">VALOR TERRENO</h2>
                <p class="text-xs md:text-sm text-slate-500 leading-relaxed mb-2 md:mb-8">Buscador Oficial MEF. Planos arancelarios por distrito.</p>
                <span class="text-xs font-bold text-brand-blue flex items-center gap-2 md:justify-center">ACCEDER <i class="fa-solid fa-arrow-right"></i></span>
            </div>
        </div>
 
        <div onclick="switchView('view-edificacion')" class="menu-card bg-white p-6 md:p-8 rounded-2xl shadow-glow border border-white cursor-pointer flex flex-row md:flex-col items-center gap-4 md:gap-0 h-full group relative overflow-hidden">
             <div class="absolute right-0 top-0 p-4 opacity-5 md:opacity-100 md:static">
                <div class="w-16 h-16 md:w-20 md:h-20 bg-blue-50 rounded-2xl md:rounded-full flex items-center justify-center md:mb-6 group-hover:bg-brand-blue transition-colors duration-300">
                    <i class="fa-solid fa-building-columns text-2xl md:text-3xl text-brand-blue group-hover:text-brand-yellow"></i>
                </div>
            </div>
            <div class="flex-1 text-left md:text-center z-10">
                <h2 class="text-xl md:text-2xl font-bold text-slate-800 font-heading mb-1 md:mb-3">EDIFICACIÓN</h2>
                <p class="text-xs md:text-sm text-slate-500 leading-relaxed mb-2 md:mb-8">Calculadora Oficial MVCS. Depreciación y Costos Directos.</p>
                <span class="text-xs font-bold text-brand-blue flex items-center gap-2 md:justify-center">ACCEDER <i class="fa-solid fa-arrow-right"></i></span>
            </div>
        </div>
 
        <div onclick="switchView('view-presupuesto')" class="menu-card bg-white p-6 md:p-8 rounded-2xl shadow-glow border border-white cursor-pointer flex flex-row md:flex-col items-center gap-4 md:gap-0 h-full group relative overflow-hidden">
             <div class="absolute right-0 top-0 p-4 opacity-5 md:opacity-100 md:static">
                <div class="w-16 h-16 md:w-20 md:h-20 bg-blue-50 rounded-2xl md:rounded-full flex items-center justify-center md:mb-6 group-hover:bg-brand-blue transition-colors duration-300">
                    <i class="fa-solid fa-calculator text-2xl md:text-3xl text-brand-blue group-hover:text-brand-yellow"></i>
                </div>
            </div>
            <div class="flex-1 text-left md:text-center z-10">
                <h2 class="text-xl md:text-2xl font-bold text-slate-800 font-heading mb-1 md:mb-3">PRESUPUESTO</h2>
                <p class="text-xs md:text-sm text-slate-500 leading-relaxed mb-2 md:mb-8">Estimación referencial con valores unitarios Dic. 2025.</p>
                <span class="text-xs font-bold text-brand-blue flex items-center gap-2 md:justify-center">ACCEDER <i class="fa-solid fa-arrow-right"></i></span>
            </div>
        </div>
      </div>
    </main>
    
    <footer class="text-center py-6 text-slate-400 text-xs safe-pb">
        <p>LAB URBAN RISK &copy; 2026</p>
    </footer>
  </div>
 
  <div id="view-terreno" class="view-section bg-slate-50">
    <nav class="glass-header p-3 sticky top-0 z-50 flex justify-between items-center shadow-sm safe-pt">
       <div class="flex items-center gap-3">
         <div class="bg-brand-blue text-white w-9 h-9 flex items-center justify-center font-bold text-base rounded-lg shadow-md font-heading">1</div>
         <div>
           <h2 class="text-brand-blue font-bold text-base font-heading leading-none">ARANCELES</h2>
           <p class="text-[10px] text-slate-400 font-medium tracking-wide">MEF 2026</p>
         </div>
       </div>
       <button onclick="goHome()" class="text-slate-500 hover:text-brand-red w-9 h-9 flex items-center justify-center rounded-full hover:bg-slate-100 transition">
         <i class="fa-solid fa-xmark text-lg"></i>
       </button>
    </nav>
 
    <div class="flex-1 w-full max-w-3xl mx-auto p-4 flex flex-col gap-4">
       <div class="bg-white rounded-2xl shadow-sm p-6 text-center border border-slate-100 relative overflow-hidden">
         <h3 class="font-heading text-brand-blue text-2xl mb-1">BUSCADOR</h3>
         <p class="text-slate-400 mb-6 text-xs">Ingrese Distrito o Ubigeo.</p>
         
         <div class="relative w-full group">
            <input id="t1_search" type="text" class="w-full py-4 pl-12 pr-4 text-base bg-slate-50 border border-slate-200 rounded-xl font-bold text-brand-blue placeholder:text-slate-300 focus:bg-white focus:ring-4 focus:ring-blue-50/50 transition-all uppercase" placeholder="EJ: SAN ISIDRO...">
            <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-lg"></i>
         </div>
       </div>
 
       <div class="bg-white rounded-2xl shadow-sm border border-slate-100 flex-1 flex flex-col overflow-hidden min-h-[50vh]">
         <div class="px-5 py-3 bg-slate-50 border-b border-slate-100 flex justify-between items-center">
           <span class="font-bold text-slate-600 text-xs uppercase tracking-wider">Resultados</span>
           <span class="text-[10px] bg-brand-blue text-white px-2 py-1 rounded-full font-bold" id="t1_count">0</span>
         </div>
         <div id="t1_list" class="flex-1 overflow-y-auto custom-scroll p-3 space-y-2 bg-white pb-10">
            <div class="h-full flex flex-col items-center justify-center opacity-40 py-10">
              <i class="fa-solid fa-database text-3xl mb-3 text-slate-300"></i>
              <p class="text-slate-400 font-medium text-xs">Esperando búsqueda...</p>
            </div>
         </div>
       </div>
    </div>
  </div>
 
  <div id="view-edificacion" class="view-section bg-slate-100">
    <nav class="glass-header p-3 sticky top-0 z-50 flex justify-between items-center shadow-sm safe-pt">
      <div class="flex items-center gap-3">
        <div class="bg-brand-blue text-white w-9 h-9 flex items-center justify-center font-bold text-base rounded-lg shadow-md font-heading">2</div>
        <div>
          <h2 class="text-brand-blue font-bold text-base font-heading leading-none">EDIFICACIÓN</h2>
          <p class="text-[10px] text-slate-400 font-medium tracking-wide">CALCULADORA</p>
        </div>
      </div>
      <button onclick="goHome()" class="text-slate-500 hover:text-brand-red w-9 h-9 flex items-center justify-center rounded-full hover:bg-slate-100 transition">
        <i class="fa-solid fa-xmark text-lg"></i>
      </button>
    </nav>
 
    <div class="flex-1 w-full max-w-[1400px] mx-auto p-3 md:p-6 lg:grid lg:grid-cols-12 gap-6 items-start pb-32 lg:pb-6">
       
       <div class="lg:col-span-7 bg-white rounded-2xl shadow-sm border border-slate-200 flex flex-col overflow-hidden mb-4 lg:mb-0">
         <div class="px-5 py-3 bg-slate-50 border-b border-slate-100 flex justify-between items-center z-10 sticky top-0">
            <span class="text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2"><i class="fa-solid fa-sliders"></i> Datos</span>
            <button onclick="t2_reset()" class="text-[10px] text-brand-red font-bold hover:bg-red-50 px-3 py-1 rounded transition border border-red-100">BORRAR</button>
         </div>
         
         <div class="p-5 space-y-6 bg-white">
            <div class="bg-blue-50/50 p-4 rounded-xl border border-blue-100">
               <label class="block text-[10px] font-bold text-brand-blue mb-1 uppercase tracking-wide">1. Región Tarifaria</label>
               <div class="relative">
                 <select id="t2_region" onchange="t2_refresh()" class="w-full p-3.5 border border-blue-200 rounded-lg font-bold text-brand-blue bg-white text-sm shadow-sm">
                     <option value="lima">LIMA Y CALLAO</option>
                     <option value="costa">COSTA</option>
                     <option value="sierra">SIERRA</option>
                     <option value="selva">SELVA</option>
                 </select>
               </div>
            </div>
 
            <div>
               <div class="flex items-center gap-2 mb-3 pb-2 border-b border-slate-100">
                 <span class="bg-brand-blue text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-bold">A</span>
                 <label class="text-xs font-bold text-slate-800 uppercase">Depreciación & Áreas</label>
               </div>
               
               <div class="space-y-4">
                 <div>
                   <label class="text-[11px] font-semibold text-slate-500 block mb-1">TIPO DE USO</label>
                   <select id="t2_tipo_edif" onchange="t2_calc()" class="w-full p-3 border border-slate-200 rounded-lg text-sm font-medium bg-slate-50 text-slate-700">
                      <option value="1">1. Casa Habitación / Dpto</option>
                      <option value="2">2. Tiendas / Depósitos</option>
                      <option value="3">3. Oficinas</option>
                      <option value="4">4. Salud / Industria</option>
                   </select>
                 </div>
 
                 <div class="grid grid-cols-2 gap-3">
                    <div>
                      <label class="text-[11px] font-semibold text-slate-500 block mb-1">MATERIAL</label>
                      <select id="t2_mat" onchange="t2_calc()" class="w-full p-3 border border-slate-200 rounded-lg text-sm font-medium bg-slate-50">
                         <option value="concreto">Concreto</option>
                         <option value="adobe">Adobe</option>
                      </select>
                    </div>
                    <div>
                      <label class="text-[11px] font-semibold text-slate-500 block mb-1">ESTADO</label>
                      <select id="t2_est" onchange="t2_calc()" class="w-full p-3 border border-slate-200 rounded-lg text-sm font-medium bg-slate-50">
                         <option value="0">Muy Bueno</option>
                         <option value="1">Bueno</option>
                         <option value="2">Regular</option>
                         <option value="3">Malo</option>
                      </select>
                    </div>
                 </div>
                 
                 <div class="grid grid-cols-12 gap-3">
                    <div class="col-span-4">
                      <label class="text-[11px] font-semibold text-slate-500 block mb-1">ANTIGÜEDAD</label>
                      <div class="relative">
                        <input type="number" id="t2_ant" value="0" min="0" oninput="t2_calc()" class="w-full p-3 border border-slate-200 rounded-lg text-center text-sm font-bold text-slate-700 bg-slate-50">
                        <span class="absolute right-2 top-1/2 -translate-y-1/2 text-[10px] text-slate-400">años</span>
                      </div>
                    </div>
                    <div class="col-span-8">
                      <label class="text-[11px] font-bold text-brand-blue block mb-1">ÁREA TECHADA (m²)</label>
                      <input type="number" id="t2_area" value="100" min="1" oninput="t2_calc()" class="w-full p-3 border border-blue-200 rounded-lg text-center font-bold text-brand-blue bg-blue-50/30 focus:bg-white text-lg">
                    </div>
                 </div>
               </div>
            </div>
 
            <div>
               <div class="flex items-center gap-2 mb-3 pb-2 border-b border-slate-100">
                 <span class="bg-brand-blue text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-bold">B</span>
                 <label class="text-xs font-bold text-slate-800 uppercase">Valores Unitarios</label>
               </div>
               <div id="t2_cats_list" class="space-y-4"></div>
            </div>
 
            <div>
               <div class="flex items-center gap-2 mb-3 pb-2 border-b border-slate-100">
                  <span class="bg-brand-blue text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-bold">C</span>
                  <label class="text-xs font-bold text-slate-800 uppercase">Obras Complementarias</label>
               </div>
               <div class="bg-slate-50 p-3 rounded-xl border border-slate-200">
                  <div class="flex flex-col gap-3">
                     <select id="t2_obra_sel" class="w-full p-3 border border-slate-200 rounded-lg text-xs font-medium text-slate-600 shadow-sm"></select>
                     <div class="flex gap-2">
                        <input id="t2_obra_qty" type="number" placeholder="#" class="w-20 p-3 border border-slate-200 rounded-lg text-center text-sm font-bold bg-white">
                        <button onclick="t2_addObra()" class="flex-1 bg-slate-800 text-white rounded-lg text-xs font-bold hover:bg-black uppercase shadow-lg shadow-slate-300 transition-all flex items-center justify-center gap-2 active:scale-95">
                          <i class="fa-solid fa-plus"></i> Agregar
                        </button>
                     </div>
                  </div>
                  <div id="t2_added_list" class="mt-3 space-y-1"></div>
               </div>
            </div>
 
            <div class="bg-orange-50 p-4 rounded-xl border border-orange-100 flex items-center justify-between gap-4">
               <div class="flex-1">
                  <label class="text-[10px] font-bold text-orange-600 uppercase mb-1 block">D. Valor Terreno (S/)</label>
                  <p class="text-[9px] text-orange-400 leading-tight">Dato de Herramienta 1</p>
               </div>
               <div class="w-32">
                  <input type="number" id="t2_val_terreno" placeholder="0" oninput="t2_calc()" class="w-full p-3 border border-orange-200 rounded-lg text-right font-black text-lg text-slate-700 bg-white focus:ring-orange-200">
               </div>
            </div>
         </div>
       </div>
 
       <div class="fixed bottom-0 left-0 w-full bg-white border-t border-slate-200 shadow-[0_-5px_20px_rgba(0,0,0,0.1)] z-50 p-4 pb-8 safe-pb lg:hidden transition-transform duration-300">
          <div class="flex justify-between items-end">
             <div>
                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-1">VALOR TOTAL ESTIMADO</span>
                <span class="text-xs text-brand-blue font-semibold">S/ m²: <span id="res_unit_mob">0.00</span></span>
             </div>
             <div class="text-right">
                <span class="text-lg font-bold text-slate-500 mr-1">S/</span>
                <span id="res_total_mob" class="text-3xl font-heading font-bold text-brand-blue">0.00</span>
             </div>
          </div>
       </div>
 
       <div class="hidden lg:flex lg:col-span-5 flex-col h-full lg:sticky lg:top-24">
         <div class="bg-brand-blue text-white p-8 rounded-2xl shadow-2xl flex flex-col justify-center items-center text-center relative overflow-hidden ring-4 ring-white">
            <div class="absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
            <div class="absolute bottom-0 left-0 w-40 h-40 bg-brand-yellow opacity-10 rounded-full blur-2xl translate-y-1/2 -translate-x-1/2"></div>
            
            <h3 class="font-heading text-brand-yellow text-xl mb-6 tracking-widest relative z-10">RESUMEN VALUACIÓN</h3>
            
            <div class="w-full space-y-3 text-sm mb-8 border-b border-white/10 pb-6 relative z-10">
               <div class="flex justify-between items-center"><span class="text-blue-200 font-light">Edificación</span><span id="res_edif" class="font-mono font-bold">S/ 0.00</span></div>
               <div class="flex justify-between items-center"><span class="text-blue-200 font-light">Obras Comp.</span><span id="res_obras" class="font-mono font-bold">S/ 0.00</span></div>
               <div class="flex justify-between items-center"><span class="text-orange-300 font-light">Terreno</span><span id="res_terreno" class="font-mono font-bold text-orange-400">S/ 0.00</span></div>
            </div>
            
            <div class="relative z-10">
               <span class="bg-white/10 text-white px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest backdrop-blur-sm">TOTAL PREDIO</span>
               <div class="flex items-start justify-center mt-2">
                  <span class="text-2xl opacity-60 font-serif mt-2 mr-2">S/.</span>
                  <span id="res_total" class="text-6xl font-bold font-heading text-white tracking-tight">0.00</span>
               </div>
            </div>
            
            <div class="mt-8 bg-black/20 px-4 py-2 rounded-full text-xs font-mono text-blue-200 backdrop-blur-md">
               Unitario: <span id="res_unit" class="text-brand-yellow font-bold">0.00</span> S/m²
            </div>
         </div>
       </div>
    </div>
  </div>
 
  <div id="view-presupuesto" class="view-section bg-slate-50">
    <nav class="glass-header p-3 sticky top-0 z-50 flex justify-between items-center shadow-sm safe-pt">
      <div class="flex items-center gap-3">
        <div class="bg-brand-blue text-white w-9 h-9 flex items-center justify-center font-bold text-base rounded-lg shadow-md font-heading">3</div>
        <div>
          <h2 class="text-brand-blue font-bold text-base font-heading leading-none">PRESUPUESTO</h2>
          <p class="text-[10px] text-slate-400 font-medium tracking-wide">OBRA NUEVA</p>
        </div>
      </div>
      <button onclick="goHome()" class="text-slate-500 hover:text-brand-red w-9 h-9 flex items-center justify-center rounded-full hover:bg-slate-100 transition">
        <i class="fa-solid fa-xmark text-lg"></i>
      </button>
    </nav>
 
    <div class="flex-1 w-full max-w-[1400px] mx-auto p-3 md:p-6 lg:grid lg:grid-cols-12 gap-6 items-start pb-32 lg:pb-6">
       
       <div class="lg:col-span-5 bg-white rounded-2xl shadow-sm border border-slate-200 flex flex-col overflow-hidden mb-4 lg:mb-0">
         <div class="p-4 bg-slate-50 border-b border-slate-100"><h3 class="font-bold text-slate-700 text-xs uppercase tracking-wider flex items-center gap-2"><i class="fa-solid fa-list-check"></i> Configuración</h3></div>
         
         <div class="p-5 space-y-6 bg-white">
            <div>
               <label class="text-[10px] font-bold text-brand-blue uppercase border-b border-slate-100 block pb-1 mb-3">Proyecto</label>
               <div class="grid grid-cols-2 gap-4">
                  <div>
                    <label class="text-[10px] font-bold text-slate-400 block mb-1">ÁREA TECHADA (m²)</label>
                    <input type="number" id="t3_area" value="100" oninput="t3_calc()" class="w-full p-3 border border-slate-200 rounded-lg text-center font-bold text-slate-700 text-lg focus:border-brand-blue">
                  </div>
                  <div>
                    <label class="text-[10px] font-bold text-slate-400 block mb-1">N° PISOS</label>
                    <input type="number" id="t3_pisos" value="1" oninput="t3_calc()" class="w-full p-3 border border-slate-200 rounded-lg text-center font-bold text-slate-700 text-lg focus:border-brand-blue">
                  </div>
               </div>
            </div>
 
            <div>
               <label class="text-[10px] font-bold text-brand-blue uppercase border-b border-slate-100 block pb-1 mb-3">Gastos (% del Costo)</label>
               <div class="grid grid-cols-3 gap-3">
                  <div>
                    <label class="text-[10px] font-bold text-slate-400 block mb-1">G. GRAL</label>
                    <input type="number" id="t3_gg" value="15" oninput="t3_calc()" class="w-full p-2.5 border border-slate-200 rounded-lg text-center font-bold text-slate-600">
                  </div>
                  <div>
                    <label class="text-[10px] font-bold text-slate-400 block mb-1">UTILIDAD</label>
                    <input type="number" id="t3_util" value="10" oninput="t3_calc()" class="w-full p-2.5 border border-slate-200 rounded-lg text-center font-bold text-slate-600">
                  </div>
                  <div>
                    <label class="text-[10px] font-bold text-slate-400 block mb-1">IGV</label>
                    <input type="number" id="t3_igv" value="18" class="w-full p-2.5 border border-slate-200 bg-slate-100 rounded-lg text-center font-bold text-slate-400" readonly>
                  </div>
               </div>
            </div>
 
            <div>
               <label class="text-[10px] font-bold text-brand-blue uppercase border-b border-slate-100 block pb-1 mb-3">Acabados (S/m²)</label>
               <div id="t3_cats_container" class="space-y-4"></div>
            </div>
            
            <button onclick="t3_reset()" class="w-full py-3 bg-white border border-slate-200 text-slate-500 rounded-xl text-xs font-bold hover:bg-brand-red hover:text-white hover:border-brand-red transition-colors shadow-sm">
              REINICIAR CÁLCULO
            </button>
         </div>
       </div>
 
       <div class="fixed bottom-0 left-0 w-full bg-slate-900 border-t border-slate-700 shadow-[0_-5px_20px_rgba(0,0,0,0.3)] z-50 p-4 pb-8 safe-pb lg:hidden transition-transform duration-300">
          <div class="flex justify-between items-end">
             <div>
                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-1">COSTO TOTAL OBRA</span>
                <span class="text-xs text-brand-yellow font-semibold">Incl. IGV</span>
             </div>
             <div class="text-right">
                <span class="text-lg font-bold text-slate-500 mr-1">S/</span>
                <span id="t3_total_mob" class="text-3xl font-heading font-bold text-white">0.00</span>
             </div>
          </div>
       </div>
 
       <div class="hidden lg:flex lg:col-span-7 bg-slate-900 text-white rounded-2xl shadow-2xl p-8 flex-col justify-center items-center text-center sticky top-24 border-t-8 border-brand-yellow relative overflow-hidden">
         <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10"></div>
         
         <h4 class="text-brand-yellow font-heading text-2xl mb-8 tracking-[0.2em] relative z-10">COSTO ESTIMADO</h4>
         
         <div class="w-full max-w-md space-y-4 text-sm mb-10 border-b border-white/10 pb-8 relative z-10">
            <div class="flex justify-between items-end border-b border-white/5 pb-2">
              <span class="text-slate-400">Costo Directo</span>
              <span id="t3_cd" class="font-mono font-bold text-lg">S/ 0.00</span>
            </div>
            <div class="flex justify-between items-end border-b border-white/5 pb-2">
              <span class="text-slate-500 text-xs uppercase">Gastos Grales. + Utilidad</span>
              <span id="t3_gg_util" class="font-mono text-slate-300">S/ 0.00</span>
            </div>
            <div class="flex justify-between items-end pt-2">
              <span class="text-brand-yellow text-xs font-bold uppercase">Impuesto General (IGV)</span>
              <span id="t3_val_igv" class="font-mono text-brand-yellow">S/ 0.00</span>
            </div>
         </div>
         
         <div class="relative z-10 scale-110">
            <span class="text-3xl text-slate-600 font-serif align-top mr-2">S/.</span>
            <span id="t3_total" class="text-6xl font-bold font-heading text-white">0.00</span>
         </div>
         
         <p class="text-[10px] text-slate-500 mt-8 max-w-sm mx-auto relative z-10 leading-relaxed">
           * Presupuesto referencial basado en Valores Unitarios Oficiales (Lima Metro y Callao, Dic 2025).
         </p>
       </div>
    </div>
  </div>
 
  <script>
    /* LÓGICA DE NAVEGACIÓN */
    function switchView(id) { 
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active')); 
        document.getElementById(id).classList.add('active'); 
        window.scrollTo(0,0); 
    }
    function goHome() { switchView('view-landing'); }
 
    /* T1: ARANCELES */
    let allFeatures = [];
    function initT1() {
       fetch('distritos_mef_2026_con_zip.geojson')
        .then(r => r.json()).then(data => { 
            allFeatures = data.features; 
            document.getElementById('t1_list').innerHTML = '<div class="h-full flex flex-col items-center justify-center opacity-40"><i class="fa-solid fa-check-circle text-4xl mb-3 text-green-500"></i><p class="text-slate-400 font-medium text-xs">Base de datos cargada.</p></div>'; 
        })
        .catch(e => document.getElementById('t1_list').innerHTML = '<div class="text-center p-6 text-brand-red text-xs font-bold bg-red-50 rounded-lg">⚠️ Error al cargar datos.<br>Revise su conexión.</div>');
       
       document.getElementById('t1_search').addEventListener('input', (e) => {
           const q = e.target.value.toUpperCase();
           if(q.length < 2) return;
           const res = allFeatures.filter(f => (f.properties.distrito||"").includes(q) || (f.properties.ubigeo||"").startsWith(q)).slice(0,50);
           
           document.getElementById('t1_list').innerHTML = res.map(r => `
             <div class="bg-white border border-slate-100 p-4 rounded-xl mb-2 shadow-sm flex justify-between items-center group active:scale-[0.98] transition-transform">
               <div>
                 <div class="font-bold text-brand-blue text-sm"><i class="fa-solid fa-location-dot mr-2 text-brand-red"></i>${r.properties.distrito}</div>
                 <div class="text-[10px] text-slate-400 font-mono mt-1 ml-6">UBIGEO: ${r.properties.ubigeo}</div>
               </div>
               ${r.properties.mef_zip_url ? `<a href="${r.properties.mef_zip_url}" target="_blank" class="w-10 h-10 bg-brand-red text-white rounded-lg flex items-center justify-center shadow-lg active:bg-brand-blue transition-colors"><i class="fa-solid fa-download"></i></a>`:''}
             </div>`).join('');
           document.getElementById('t1_count').innerText = res.length;
       });
    }
 
    /* T2: DATA */
    const T2_CATS_FULL = [
        {l:"1. Muros y Columnas",opts:[{l:"A. Estructuras laminares...",v:{lima:976.30,costa:894.27,sierra:1010.95,selva:995.50}},{l:"B. Columnas, vigas...",v:{lima:629.46,costa:576.57,sierra:601.44,selva:679.21}},{l:"C. Placas concreto...",v:{lima:422.98,costa:387.43,sierra:425.98,selva:489.75}},{l:"D. Ladrillo s/confinar...",v:{lima:409.04,costa:374.68,sierra:393.47,selva:378.67}},{l:"E. Adobe, tapial...",v:{lima:287.96,costa:263.77,sierra:308.89,selva:300.68}},{l:"F. Madera / Drywall...",v:{lima:222.15,costa:198.64,sierra:192.61,selva:205.37}},{l:"G. Pircado con barro",v:{lima:127.78,costa:117.05,sierra:113.49,selva:102.68}}]},
        {l:"2. Techos",opts:[{l:"A. Losa > 6m...",v:{lima:592.97,costa:543.16,sierra:525.66,selva:509.83}},{l:"B. Aligerados inclinados...",v:{lima:386.87,costa:354.37,sierra:361.40,selva:360.15}},{l:"C. Aligerado horizontal...",v:{lima:312.01,costa:285.80,sierra:246.87,selva:265.25}},{l:"D. Calamina metálica...",v:{lima:198.04,costa:181.40,sierra:251.48,selva:231.25}},{l:"E. Madera impermeab...",v:{lima:73.83,costa:67.63,sierra:76.73,selva:168.37}},{l:"F. Calamina madera...",v:{lima:41.60,costa:37.19,sierra:61.30,selva:60.91}},{l:"G. Madera rústica...",v:{lima:27.91,costa:25.57,sierra:0,selva:77.41}}]},
        {l:"3. Puertas y Ventanas",opts:[{l:"A. Aluminio pesado...",v:{lima:529.84,costa:485.33,sierra:399.00,selva:421.72}},{l:"B. Aluminio diseño...",v:{lima:279.28,costa:255.81,sierra:353.08,selva:334.51}},{l:"C. Aluminio, vidrio...",v:{lima:176.22,costa:161.41,sierra:167.13,selva:248.79}},{l:"D. Ventanas aluminio...",v:{lima:154.35,costa:141.39,sierra:147.50,selva:166.76}},{l:"E. Ventanas fierro...",v:{lima:132.06,costa:120.98,sierra:112.67,selva:108.28}},{l:"F. Fierro industrial...",v:{lima:101.56,costa:90.81,sierra:87.12,selva:88.32}},{l:"G. Madera corriente...",v:{lima:53.56,costa:49.05,sierra:51.34,selva:52.11}}]}
    ];
    const OBRAS_96 = [{n:"Muro concreto (m2)",p:{lima:453.45,costa:443.89,sierra:444.14,selva:457.72}},{n:"Muro ladrillo (m2)",p:{lima:383.77,costa:375.68,sierra:375.89,selva:387.38}},{n:"Cerco fierro (m2)",p:{lima:206.30,costa:201.95,sierra:202.06,selva:208.24}},{n:"Puerta fierro (m2)",p:{lima:618.00,costa:604.98,sierra:605.31,selva:623.83}},{n:"Tanque Elevado (m3)",p:{lima:1316.09,costa:1288.35,sierra:1289.07,selva:1328.49}},{n:"Cisterna (m3)",p:{lima:1488.89,costa:1457.50,sierra:1458.31,selva:1502.91}}];
    const DEPREC_TABLE = {'concreto':[{max:5,vals:[0,5,10,55]},{max:50,vals:[18,23,28,73]},{max:999,vals:[27,35,47,87]}],'adobe':[{max:5,vals:[5,15,30,65]},{max:999,vals:[40,50,65,95]}]};
 
    let t2_added = [];
    
    function t2_refresh() {
       const reg = document.getElementById('t2_region').value;
       document.getElementById('t2_cats_list').innerHTML = '';
       T2_CATS_FULL.forEach(c => {
          let ops = `<option value="0">-- Seleccionar --</option>`;
          c.opts.forEach(o => { if(o.v[reg]!==undefined) ops+=`<option value="${o.v[reg]}">${o.l.substring(0,30)}... (S/${o.v[reg].toFixed(2)})</option>`; });
          document.getElementById('t2_cats_list').innerHTML += `<div class="mb-3"><label class="text-[10px] font-bold text-slate-500 uppercase block mb-1">${c.l}</label><select class="t2-sel w-full p-3 border border-slate-200 rounded-lg text-sm font-medium bg-slate-50 focus:bg-white text-brand-blue" onchange="t2_calc()">${ops}</select></div>`;
       });
       document.getElementById('t2_obra_sel').innerHTML = OBRAS_96.map(o=>`<option value="${o.p[reg]}">${o.n} - S/${o.p[reg].toFixed(2)}</option>`).join('');
       t2_calc();
    }
 
    function t2_calc() {
       let u = 0; document.querySelectorAll('.t2-sel').forEach(s => u += parseFloat(s.value));
       const age = parseInt(document.getElementById('t2_ant').value) || 0;
       const mat = document.getElementById('t2_mat').value;
       const est = parseInt(document.getElementById('t2_est').value);
       
       let dep = 50;
       const table = DEPREC_TABLE[mat] || DEPREC_TABLE['concreto'];
       const range = table.find(r => age <= r.max) || table[table.length-1];
       if(range && range.vals[est] !== undefined) dep = range.vals[est];
       
       const area = parseFloat(document.getElementById('t2_area').value) || 0;
       const valEdif = u * area * (1 - dep/100);
       const valObras = t2_added.reduce((a,b)=>a+b.t,0);
       const valTerr = parseFloat(document.getElementById('t2_val_terreno').value)||0;
       const total = valEdif+valObras+valTerr;
       
       // Update Desktop
       document.getElementById('res_edif').innerText = "S/ " + valEdif.toLocaleString('es-PE', {minimumFractionDigits: 2});
       document.getElementById('res_obras').innerText = "S/ " + valObras.toLocaleString('es-PE', {minimumFractionDigits: 2});
       document.getElementById('res_terreno').innerText = "S/ " + valTerr.toLocaleString('es-PE', {minimumFractionDigits: 2});
       document.getElementById('res_total').innerText = total.toLocaleString('es-PE', {minimumFractionDigits: 2});
       
       // Update Mobile Floating Bar
       document.getElementById('res_total_mob').innerText = total.toLocaleString('es-PE', {minimumFractionDigits: 2});
       const unit = area > 0 ? (valEdif+valObras)/area : 0;
       document.getElementById('res_unit').innerText = unit.toLocaleString('es-PE', {minimumFractionDigits: 2});
       document.getElementById('res_unit_mob').innerText = unit.toLocaleString('es-PE', {minimumFractionDigits: 2});
    }
 
    function t2_addObra() {
       const s=document.getElementById('t2_obra_sel'), q=document.getElementById('t2_obra_qty').value;
       if(q>0) { t2_added.push({id:Date.now(), n:s.options[s.selectedIndex].text, q, t:s.value*q}); renderAdded(); t2_calc(); }
    }
    function renderAdded() {
      document.getElementById('t2_added_list').innerHTML = t2_added.map(x=>`<div class="text-[11px] flex justify-between bg-white p-2.5 border border-slate-100 rounded-lg shadow-sm mb-2 items-center"><span>${x.n.split('-')[0]} <span class="bg-blue-50 text-brand-blue font-bold px-1.5 rounded ml-1">x${x.q}</span></span><span class="font-bold text-slate-700">S/${x.t.toFixed(2)}</span></div>`).join('');
    }
    function t2_reset() { t2_added=[]; renderAdded(); document.querySelectorAll('#view-edificacion select').forEach(s=>s.selectedIndex=0); t2_refresh(); }
 
    /* T3: PRESUPUESTO */
    const T3_CATS = [{l:"1. Muros y Columnas",opts:[{l:"A. Estructuras laminares...",v:649.56},{l:"B. Columnas, vigas...",v:418.80},{l:"C. Placas concreto...",v:288.29},{l:"D. Ladrillo s/confinar...",v:278.79}]},{l:"2. Techos",opts:[{l:"A. Losa > 6m...",v:394.53},{l:"B. Aligerados inclinados...",v:348.42},{l:"C. Aligerado horizontal...",v:212.66}]},{l:"3. Pisos",opts:[{l:"A. Mármol / Porcelanato...",v:257.40},{l:"B. Parquet fino...",v:208.83},{l:"C. Laminado / Cerámico...",v:121.24}]},{l:"4. Puertas y Ventanas",opts:[{l:"A. Aluminio pesado...",v:379.97},{l:"B. Vidrio tratado...",v:120.09},{l:"C. Vidrio polarizado...",v:105.20}]},{l:"5. Revestimientos",opts:[{l:"A. Mármol / Madera...",v:352.52},{l:"B. Enchape techos...",v:287.88},{l:"C. Caravista...",v:213.57}]},{l:"6. Baños",opts:[{l:"A. Lujo importado...",v:185.81},{l:"B. Importados...",v:97.49},{l:"C. Nacionales...",v:67.63}]},{l:"7. Instalaciones",opts:[{l:"A. A/C, Especiales...",v:376.82},{l:"B. Ascensor, Bombas...",v:275.13},{l:"C. Agua, Trifásica...",v:109.64}]}];
 
    function t3_init() {
       document.getElementById('t3_cats_container').innerHTML = T3_CATS.map(x => `<div class="mb-3"><label class="text-[10px] font-bold text-slate-500 uppercase block mb-1">${x.l}</label><select class="t3-sel w-full p-3 border border-slate-200 rounded-lg text-xs font-medium text-slate-600 bg-slate-50" onchange="t3_calc()"><option value="0">-- Seleccionar --</option>${x.opts.map(o=>`<option value="${o.v}">${o.l} S/${o.v.toFixed(2)}</option>`).join('')}</select></div>`).join('');
    }
 
    function t3_calc() {
       let u=0; document.querySelectorAll('.t3-sel').forEach(s=>u+=parseFloat(s.value));
       const area=parseFloat(document.getElementById('t3_area').value)||0, pis=document.getElementById('t3_pisos').value, gg=document.getElementById('t3_gg').value, util=document.getElementById('t3_util').value, igv=document.getElementById('t3_igv').value;
       
       const cd = u*area*(pis>=5?1.05:1);
       const sub = cd*(1+(parseFloat(gg)+parseFloat(util))/100);
       const tot = sub*(1+parseFloat(igv)/100);
       
       document.getElementById('t3_cd').innerText = "S/ "+cd.toLocaleString('es-PE',{minimumFractionDigits:2});
       document.getElementById('t3_gg_util').innerText = "S/ "+(cd*((parseFloat(gg)+parseFloat(util))/100)).toLocaleString('es-PE',{minimumFractionDigits:2});
       // Desktop
       document.getElementById('t3_val_igv').innerText = "S/ "+(sub*(igv/100)).toLocaleString('es-PE',{minimumFractionDigits:2});
       document.getElementById('t3_total').innerText = tot.toLocaleString('es-PE',{minimumFractionDigits:2});
       // Mobile Sticky
       document.getElementById('t3_total_mob').innerText = tot.toLocaleString('es-PE',{minimumFractionDigits:2});
    }
    function t3_reset() { document.querySelectorAll('.t3-sel').forEach(s=>s.selectedIndex=0); t3_calc(); }
 
    // Init All
    window.onload = function() { t2_refresh(); t3_init(); initT1(); };
  </script>
</body>
</html>
